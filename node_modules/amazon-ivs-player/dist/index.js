/*! For license information please see index.js.LICENSE.txt */
!function(){"use strict";var e={n:function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,{a:n}),n},d:function(t,n){for(var i in n)e.o(n,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:n[i]})}};e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),e.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},e.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var t={};e.r(t),e.d(t,{AuthorizationError:function(){return Wt},CaptureEventType:function(){return jt},ErrorSource:function(){return Ft},ErrorType:function(){return Gt},LogLevel:function(){return Kt},MediaPlayer:function(){return Ht},MetadataEventType:function(){return ye},MetadataID3Type:function(){return Ee},PlayerEventType:function(){return V},PlayerState:function(){return Se},RemotePlayerEvent:function(){return ke},create:function(){return xt},createWorker:function(){return Ot},getVersion:function(){return Ut},isPlayerSupported:function(){return Vt},isVP9Supported:function(){return G},isWasmSupported:function(){return Nt},registerIVSQualityPlugin:function(){return Zt},registerIVSTech:function(){return zt}});var n=require("bowser"),i=require("@babel/runtime/helpers/createClass"),r=e.n(i),o=101,a=function(){function e(){this.buffer=void 0,this.head=void 0,this.tail=void 0,this.buffer=[],this.head=0,this.tail=0}var t=e.prototype;return t.push=function(e){this.tail===this.buffer.length?this.buffer.push(e):this.buffer[this.tail]=e,this.tail++},t.pop=function(){var e,t=null!=(e=this.buffer[this.head])?e:null;return this.buffer[this.head]=null,this.head++,this.empty()&&(this.head=0,this.tail=0),t},t.size=function(){return this.tail-this.head},t.empty=function(){return this.head>=this.tail},e}();function s(e){try{return JSON.parse(e)}catch(t){return console.error("Failed JSON parse:",e),{}}}function u(e){return""===e.codecs||"undefined"==typeof MediaSource||MediaSource.isTypeSupported('video/mp4;codecs="'+e.codecs+'"')}function c(e){var t,n;return void 0!==e.hidden?(t="hidden",n="visibilitychange"):void 0!==e.msHidden?(t="msHidden",n="msvisibilitychange"):void 0!==e.webkitHidden&&(t="webkitHidden",n="webkitvisibilitychange"),{hidden:t,visibilityChange:n}}function d(e,t,n){return Math.min(n,Math.max(t,e))}function l(e){e.removeAttribute("src")}var h=.1,f=1<<30,v=12e4,m=3e3,p={audio:1936684398,video:1986618469};function g(e){return"number"==typeof e.webkitDecodedFrameCount?e.webkitDecodedFrameCount:"function"==typeof e.getVideoPlaybackQuality?e.getVideoPlaybackQuality().totalVideoFrames:"number"==typeof e.mozDecodedFrames?e.mozDecodedFrames:-1}function y(e){return"number"==typeof e.webkitDroppedFrameCount?e.webkitDroppedFrameCount:"function"==typeof e.getVideoPlaybackQuality?e.getVideoPlaybackQuality().droppedVideoFrames:-1}function E(e,t){for(var n=0;n<t.length;n++)console.info(e,"start: ",t.start(n),", end: ",t.end(n))}function k(e,t,n){for(var i=0;i<e.length;i++){var r=e.start(i),o=e.end(i);if(!(o<=t)){if(r-n>t)break;for(var a=i+1;a<e.length&&!(e.start(a)-o>n);a++)o=e.end(a);for(var s=i-1;s>=0&&!(r-e.end(s)>n);s--)r=e.start(s);return{start:Math.min(r,t),end:o}}}return{start:t,end:t}}function S(e,t,n){void 0===n&&(n=h);var i=k(e,t,n).end-t>n;if(e.length>1||!i)for(var r=0;r<e.length;r++){var o=e.start(r),a=e.end(r);if(t<o&&a-o>n)return o+n}return i?t+n:t}function b(e,t,n){return e.addEventListener(t,n),function(){e.removeEventListener(t,n)}}function C(e){if(e.src){var t=e.src;l(e),e.load(),URL.revokeObjectURL(t)}}function T(e){var t=(e||"").match(/codecs="([^.]+)\./);return t&&t[1]?t[1]:""}var P=function(){function e(e,t,n,i,r){this.rawCodec=t,this.group=n,this.isProtected=i,this.onError=r,this.pending=void 0,this.unsubscribers=[],this.srcBuf=void 0,this.blocked=!1,this.srcBuf=e,this.pending=new a,this.unsubscribers.push(b(e,"updateend",this.process.bind(this)))}var t=e.prototype;return t.getBufferedRanges=function(){try{var e=[];if(this.srcBuf)for(var t=this.srcBuf.buffered,n=0;n<t.length;n++)e.push({start:t.start(n),end:t.end(n)});return e}catch(e){return[]}},t.abort=function(){this.schedule((function(e){e.abort()}))},t.changeType=function(e){this.rawCodec=function(e){var t=(e||"").match(/codecs=".+"/);return t&&t[0]?t[0]:'codecs=""'}(e),this.schedule((function(t){t.changeType(e)}))},t.appendBuffer=function(e){this.schedule((function(t){try{t.appendBuffer(e)}catch(e){if("QuotaExceededError"!==e.name)throw e;var n=t.buffered,i=n.start(0),r=n.end(n.length-1),o=(i+r)/2;t.remove(o,r)}}))},t.setTimestampOffset=function(e){this.schedule((function(t){t.timestampOffset=e}))},t.remove=function(e,t){this.schedule((function(n){var i=n.buffered;if(i.length){var r=Math.max(e,i.start(0)),o=Math.min(t,i.end(i.length-1));r<o&&n.remove(r,o)}}))},t.block=function(){var e=this;return new Promise((function(t){e.schedule((function(){e.blocked=!0,t()}))}))},t.unblock=function(){this.blocked=!1,this.process()},t.destroy=function(){this.pending=new a,this.unsubscribers.forEach((function(e){return e()})),this.srcBuf=void 0},t.schedule=function(e){this.pending.empty()&&this.canProcess()?this.safeExecute(e):(this.pending.push(e),this.process())},t.safeExecute=function(e){try{if(!this.srcBuf)throw new Error("srcBuf is undefined");e(this.srcBuf)}catch(e){this.onError(e,!1)}},t.process=function(){for(;!this.pending.empty()&&this.canProcess();)this.safeExecute(this.pending.pop())},t.canProcess=function(){return!(!this.srcBuf||this.srcBuf.updating||this.blocked)},r()(e,[{key:"buffer",get:function(){return this.srcBuf}},{key:"codec",get:function(){return this.rawCodec}},{key:"timestampOffset",get:function(){return this.buffer?this.buffer.timestampOffset:0}}]),e}(),A=function(){function e(e,t,n){this.mediaSource=e,this.onEnded=t,this.onError=n,this.sourceBuffers=Object.create(null),this.unsubscribers=[],this.unsubscribers.push(b(e,"sourceended",this.onEnded))}e.isSupported=function(){return void 0!==self.MediaSource},e.isSupportedInWorker=function(){return e.isSupported()&&MediaSource.canConstructInDedicatedWorker&&"function"==typeof MediaSourceHandle},e.create=function(t,n){var i=new MediaSource,r=new Promise((function(r,o){var a=b(i,"sourceopen",(function(){"open"===i.readyState?(r(new e(i,t,n)),a()):o("The MediaSource was closed upon opening")}))}));return{ms:i,sink:r}};var t=e.prototype;return t.getBufferedRanges=function(e){var t,n;return null!=(t=null==(n=this.sourceBuffers[p[e]])?void 0:n.getBufferedRanges())?t:[]},t.addTrack=function(e,t,n,i){var r=this.mediaSource,o=this.sourceBuffers,a=function(e){return"video/mp4;"+e}(t);if(o[e]){var s,u=T(o[e].codec);return T(t)!==u&&o[e].changeType(a),null!=(s=o[e].buffer)?s:null}try{var c=r.addSourceBuffer(a);return o[e]=new P(c,t,n,i,this.handleError.bind(this)),c}catch(e){this.handleError(e,"open"===r.readyState)}return null},t.append=function(e,t){var n;null==(n=this.sourceBuffers[e])||n.appendBuffer(t)},t.remove=function(e,t){for(var n=this.sourceBuffers,i=0,r=Object.keys(n);i<r.length;i++)n[r[i]].remove(e,t)},t.setTimestampOffset=function(e,t){var n=this.sourceBuffers[e];n&&(n.abort(),n.setTimestampOffset(t))},t.setDuration=function(e){var t=this;this.scheduleUpdate((function(){return t.mediaSource.duration=e})).catch((function(e){return t.handleError(e,!1)}))},t.setLiveSeekableRange=function(e,t){var n=this;this.scheduleUpdate((function(){return n.mediaSource.setLiveSeekableRange(e,t)})).catch((function(e){return n.handleError(e,!1)}))},t.scheduleUpdate=function(e){var t=this;void 0===e&&(e=D);var n=Object.keys(this.sourceBuffers).map((function(e){return t.sourceBuffers[e]}));return Promise.all(n.map((function(e){return e.block()}))).then(e).then((function(){return n.forEach((function(e){return e.unblock()}))}))},t.isDrmProtected=function(){return this.bufferProperties.some((function(e){return e.isProtected}))},t.isAudioOnly=function(){return 1===this.bufferProperties.length&&"audio_only"===this.bufferProperties[0].group},t.destroy=function(){this.destroySourceBuffers(),this.unsubscribers.forEach((function(e){return e()})),this.unsubscribers=[]},t.handleError=function(e,t){var n=e.code||102,i=102;"NotSupportedError"===e.name&&(i=n=4),this.onError(i,n,e.message,t)},t.destroySourceBuffers=function(){for(var e=this.mediaSource;e.sourceBuffers.length>0;)try{e.removeSourceBuffer(e.sourceBuffers[0])}catch(e){this.handleError(e,!1);break}for(var t=0,n=Object.keys(this.sourceBuffers);t<n.length;t++){var i=n[t];this.sourceBuffers[i].destroy()}this.sourceBuffers=Object.create(null)},r()(e,[{key:"duration",get:function(){return this.mediaSource.duration}},{key:"bufferProperties",get:function(){var e=this.sourceBuffers;return Object.keys(e).map((function(t){var n=e[t];return{trackID:Number(t),codec:n.codec,mode:"mse",path:"",isProtected:n.isProtected,group:n.group,srcObj:null}}))}}]),e}(),D=function(){},L=/^(\d+)\.(\d+)\.(\d+)[+|-]?(.*)?$/,M=/^(\d+)\.(\d+)[+|-]?(.*)?$/,w=/^(\d+)$/,R={chrome:!1,chromecast:!1,domain:"",electron:!1,family:"",firefox:!1,host:"",major:-1,minor:-1,msEdgeLegacy:!1,msEdgeChromium:!1,msIE:!1,name:"",opera:!1,osName:"",osVersion:"",patch:-1,safari:!1,url:"",userAgent:"",mobile:!1,supportsDataChannels:!1,supportsWebTransport:!1,supportsMSEInWorkers:!1},_=null;function I(){if(_)return _;if("undefined"==typeof window||"undefined"==typeof navigator)return _=R;var e,t,i=n.getParser(navigator.userAgent),r=(e=String(i.getBrowserVersion()),t=L.exec(e)||M.exec(e)||w.exec(e)||[],{major:parseInt(t[1],10)||0,minor:parseInt(t[2],10)||0,patch:parseInt(t[3],10)||0}),o=i.getEngine();return _={chrome:!!i.some(["chrome"]),chromecast:navigator.userAgent.toLowerCase().indexOf("crkey")>-1,domain:window.location.host.split(".").slice(-2).join("."),electron:!!i.some(["electron"]),family:i.getBrowserName().toLowerCase(),firefox:!!i.some(["firefox"]),host:window.location.host,major:r.major,minor:r.minor,msEdgeLegacy:!!i.some(["microsoft edge"])&&"Blink"!==o.name,msEdgeChromium:!!i.some(["microsoft edge"])&&"Blink"===o.name,msIE:!!i.some(["internet explorer"]),name:navigator.appVersion,opera:!!i.some(["opera"]),osName:i.getOSName(),osVersion:String(i.getOSVersion()),patch:r.patch,safari:!!i.some(["safari"]),url:window.location.href,userAgent:navigator.userAgent,mobile:!(!i.some(["mobile"])&&!i.some(["tablet"])),supportsDataChannels:"RTCPeerConnection"in window,supportsWebTransport:"WebTransport"in window,supportsMSEInWorkers:A.isSupportedInWorker()}}var O=require("@babel/runtime/helpers/extends"),N=e.n(O),V=function(e){return e.INITIALIZED="PlayerInitialized",e.QUALITY_CHANGED="PlayerQualityChanged",e.DURATION_CHANGED="PlayerDurationChanged",e.VOLUME_CHANGED="PlayerVolumeChanged",e.MUTED_CHANGED="PlayerMutedChanged",e.PLAYBACK_RATE_CHANGED="PlayerPlaybackRateChanged",e.REBUFFERING="PlayerRebuffering",e.AUDIO_BLOCKED="PlayerAudioBlocked",e.PLAYBACK_BLOCKED="PlayerPlaybackBlocked",e.ERROR="PlayerError",e.RECOVERABLE_ERROR="PlayerRecoverableError",e.ANALYTICS_EVENT="PlayerAnalyticsEvent",e.TIME_UPDATE="PlayerTimeUpdate",e.SYNC_TIME_UPDATE="PlayerSyncTimeUpdate",e.BUFFER_UPDATE="PlayerBufferUpdate",e.SEEK_COMPLETED="PlayerSeekCompleted",e.SESSION_DATA="PlayerSessionData",e.STATE_CHANGED="PlayerStateChanged",e.WORKER_ERROR="PlayerWorkerError",e.METADATA="PlayerMetadata",e.TEXT_CUE="PlayerTextCue",e.TEXT_METADATA_CUE="PlayerTextMetadataCue",e.AD_CUE="PlayerAdCue",e.STREAM_SOURCE_CUE="PlayerStreamSourceCue",e.NETWORK_UNAVAILABLE="PlayerNetworkUnavailable",e.SEGMENT_DISCONTINUITY="PlayerSegmentDiscontinuity",e.SEGMENT_METADATA="PlayerSegmentMetadata",e}({}),x=null,U=null;function B(e){var t=e.type===V.ANALYTICS_EVENT,n=e.arg&&"video_error"===e.arg.name;if(t&&n){if(!x&&!U){var i=document.createElement("canvas");try{var r=i.getContext("webgl")||i.getContext("experimental-webgl");if(r&&"getExtension"in r){var o=r.getExtension("WEBGL_debug_renderer_info");o&&"getParameter"in r&&(x=r.getParameter(o.UNMASKED_RENDERER_WEBGL),U=r.getParameter(o.UNMASKED_VENDOR_WEBGL))}}catch(e){}}e.arg.properties.gl_renderer=x,e.arg.properties.gl_vendor=U}return e}var H=function(){function e(){var t=this;this.batteryManager=void 0,this.processor=this.processor.bind(this),e.isSupported()&&window.navigator.getBattery().then((function(e){t.batteryManager=e}))}return e.isSupported=function(){var e,t;return void 0!==(null==(e=window)||null==(t=e.navigator)?void 0:t.getBattery)},e.prototype.processor=function(e){var t=e.type===V.ANALYTICS_EVENT,n=e.arg&&"minute-watched"===e.arg.name;return t&&n&&this.batteryManager&&(e.arg.properties.battery_percent=this.batteryManager.level),e},e}();function F(){return"undefined"!=typeof MediaSource}function G(){var e=I();return"Windows"===e.osName&&(e.chrome||e.firefox||e.msEdgeChromium)&&F()?"mediaCapabilities"in navigator?navigator.mediaCapabilities.decodingInfo({type:"media-source",video:{contentType:'video/mp4;codecs="vp09.00.41.08"',width:1920,height:1080,bitrate:8e6,framerate:60}}).then((function(e){return e.supported&&e.smooth})):Promise.resolve(MediaSource.isTypeSupported('video/mp4;codecs="vp09.00.10.08"')):Promise.resolve(!1)}var W={keySystem:"org.w3.clearkey",uuid:"1077efec-c0b2-4d02-ace3-3c1e52e2fb4b"},j={keySystem:"com.apple.fps.2_0",certUrl:"https://fp-keyos-twitch.licensekeyserver.com/cert/a17fd33d3843df9b17679ccf50a419b2.der",licenseUrl:"https://fp-keyos-twitch.licensekeyserver.com/getkey",uuid:"94CE86FB-07FF-4F43-ADB8-93D2FA968CA2"},K={keySystem:"com.microsoft.playready",licenseUrl:"https://pr-keyos-twitch.licensekeyserver.com/core/rightsmanager.asmx",uuid:"9a04f079-9840-4286-ab92-e65be0885f95"},q={keySystem:"com.widevine.alpha",licenseUrl:"https://wv-keyos-twitch.licensekeyserver.com",uuid:"edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"},Q={CLEARKEY:W,FAIRPLAY:j,PLAYREADY:K,WIDEVINE:q},Y={"com.widevine.alpha":q,"com.microsoft.playready":K,"com.apple.fps.2_0":j,"org.w3.clearkey":W},X={value:4,message:"Your browser does not support any DRM Content Decryption Modules"},z={value:4,message:"There was an issue while updating DRM License"},J={value:204,message:"Error while requesting DRM license"},Z={value:201,message:"DRM license not authorized for this browser version"},$={value:202,message:"DRM license not available"},ee={value:203,message:"DRM license server error"},te={value:4,message:"Error creating key session"},ne={value:4,message:"Encryption key not usable because of internal error in CDM"},ie={value:4,message:"Unable to find valid CDM support on media"},re={value:2,message:"Request for AuthXML failed"},oe={value:2,message:"Request for DRM certificate failed"};function ae(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function se(e){return window.WebKitMediaKeys&&"function"==typeof window.WebKitMediaKeys.isTypeSupported&&window.WebKitMediaKeys.isTypeSupported(Q.FAIRPLAY.keySystem)?Q.FAIRPLAY.uuid:"function"==typeof navigator.requestMediaKeySystemAccess?e.safari?"":e.msIE||e.msEdgeLegacy?Q.PLAYREADY.uuid:Q.WIDEVINE.uuid:""}function ue(e,t){if((e=ce(e))===(t=ce(t)))return!0;if(e.byteLength!==t.byteLength)return!1;for(var n=new DataView(e),i=new DataView(t),r=0;r<n.byteLength;r++)if(n.getUint8(r)!==i.getUint8(r))return!1;return!0}function ce(e){return e instanceof Uint8Array||e instanceof Uint16Array?e.buffer:e}function de(e){return t=function(e){if(null===e)return[];for(var t=new DataView(e.buffer||e),n=[],i=0;!(i>=t.buffer.byteLength);){var r=i+t.getUint32(i);if(i+=4,t.getUint32(i)===ve("pssh")){i+=4;var o=t.getUint8(i);if(0===o||1===o){i++,i+=3;for(var a="",s=0;s<4;s++)a+=me(t.getUint8(i+s));i+=4,a+="-";for(var u=0;u<2;u++)a+=me(t.getUint8(i+u));i+=2,a+="-";for(var c=0;c<2;c++)a+=me(t.getUint8(i+c));i+=2,a+="-";for(var d=0;d<2;d++)a+=me(t.getUint8(i+d));i+=2,a+="-";for(var l=0;l<6;l++)a+=me(t.getUint8(i+l));i+=6,a=a.toLowerCase(),i+=4,n.push(a),i=r}else i=r}else i=r}return n}(e),n=[],t.forEach((function(e){Object.keys(Q).forEach((function(t){var i=Q[t];i.uuid.toLowerCase()===e.toLowerCase()&&n.push(i)}))})),n;var t,n}function le(e,t){return new Promise((function(n,i){var r=new XMLHttpRequest;for(var o in r.open(t.method,e,!0),t.headers)Object.prototype.hasOwnProperty.call(t.headers,o)&&r.setRequestHeader(o,t.headers[o]);r.responseType=t.responseType,r.onload=function(){200===r.status&&n(r.response)},r.onloadend=function(){i(r.status)},r.send(t.body)}))}function he(e){var t=fe(pe(JSON.parse(String.fromCharCode.apply(null,e)).sinf[0]),"schi");return function(e){for(var t,n="",i=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return ae(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ae(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(e);!(t=i()).done;)n+=me(t.value);return n}(fe(t,"tenc").subarray(8,24))}function fe(e,t){for(var n=new DataView(e.buffer,e.byteOffset,e.byteLength),i=ve(t),r=0;r<e.byteLength;){var o=n.getUint32(r);if(n.getUint32(r+4)===i)return e.subarray(r+8,r+o);r+=o}return new Uint8Array(e)}function ve(e){return(e.charCodeAt(0)<<24)+(e.charCodeAt(1)<<16)+(e.charCodeAt(2)<<8)+e.charCodeAt(3)}function me(e){var t=e.toString(16);return 1===t.length?"0"+t:t}function pe(e){for(var t=atob(e),n=t.length,i=new Uint8Array(n),r=0;r<n;r++)i[r]=t.charCodeAt(r);return i}function ge(e){return decodeURIComponent(e.replace(/\+/g," "))}var ye=function(e){return e.ID3="MetaID3",e.CAPTION="MetaCaption",e}({}),Ee=function(e){return e.METADATA_ID="metadata.live-video.net",e.INBAND_METADATA_ID="inband.metadata.live-video.net",e}({}),ke=function(e){return e.AVAILABLE="RemotePlayerAvailable",e.UNAVAILABLE="RemotePlayerUnavailable",e.SESSION_STARTED="RemotePlayerSessionStarted",e.SESSION_ENDED="RemotePlayerSessionEnded",e}({}),Se=function(e){return e.IDLE="Idle",e.READY="Ready",e.BUFFERING="Buffering",e.PLAYING="Playing",e.ENDED="Ended",e}({}),be=require("@babel/runtime/helpers/asyncToGenerator"),Ce=e.n(be),Te=require("@babel/runtime/regenerator"),Pe=e.n(Te);function Ae(e){var t=e.querySelector("Challenge"),n=null==t?void 0:t.textContent;return n?atob(n):""}function De(e){var t=e.querySelectorAll("HttpHeader");return Array.from(t).reduce((function(e,t){var n,i,r=null==(n=t.querySelector("name"))?void 0:n.textContent,o=null==(i=t.querySelector("value"))?void 0:i.textContent;return r&&o&&(e[r]=o),e}),{})}function Le(e){var t=String.fromCharCode.apply(null,new Uint16Array(e)),n=(new DOMParser).parseFromString(t,"application/xml");return{headers:De(n),body:Ae(n)}}function Me(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var we=[{initDataTypes:["cenc"],audioCapabilities:[{contentType:'audio/mp4;codecs="mp4a.40.2"'}],videoCapabilities:[{robustness:"SW_SECURE_CRYPTO",contentType:'video/mp4;codecs="avc1.42E01E"'}]}],Re=function(){function e(e){var t=this;this.video=void 0,this.listener=void 0,this.cdmSupport=void 0,this.selectedCDM=void 0,this.mediaKeys=void 0,this.pendingSessions=void 0,this.sessions=void 0,this.authXml=void 0,this.video=e.video,this.listener=e.listener,this.cdmSupport=null,this.selectedCDM=null,this.mediaKeys=void 0,this.pendingSessions=[],this.reset(),this.video.addEventListener("encrypted",(function(e){return t.handleEncrypted(e)})),this.video.addEventListener("webkitneedkey",(function(e){return t.handleWebKitEncrypted(e)}))}var t=e.prototype;return t.configure=function(e){var t=this;if(!this.authXml){var n=new URL(e),i=n.pathname.split("/"),r=i[i.length-1].split(".")[0],o=function(e){var t=new URL(e).searchParams,n={};return t.forEach((function(e,t){n[ge(t)]=e?ge(e):""})),n}(e),a=o.token,s=o.sig,u="https://"+n.host+"/api/authxml/"+r+"?token="+encodeURIComponent(a)+"&sig="+s;this.authXml=le(u,{method:"GET",responseType:"text"}).catch((function(e){t.handleError(Object.assign({code:e},re))}))}},t.reset=function(){this.authXml=null,this.sessions=[]},t.isProtected=function(){return null!==this.authXml},t.handleError=function(e){this.listener.onSinkError({value:e.value||4,code:e.code||0,message:e.message||""})},t.hasSession=function(e){if(!e)return!1;for(var t,n=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return Me(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Me(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(this.sessions);!(t=n()).done;){var i=t.value;if(i.initData&&ue(i.initData,e))return!0}return!1},t.createKeySystemSupportChain=function(){if(null===this.cdmSupport||0===this.cdmSupport.length)return Promise.reject(ie);var e=Promise.reject();return this.cdmSupport.forEach((function(t){e=e.catch((function(){return navigator.requestMediaKeySystemAccess(t.keySystem,we)}))})),e=e.catch((function(){return Promise.reject(X)}))},t.handleEncrypted=function(){var e=Ce()(Pe().mark((function e(t){var n,i;return Pe().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.hasSession(t.initData)){e.next=2;break}return e.abrupt("return");case 2:if(this.sessions.push(t),"sinf"!==t.initDataType){e.next=6;break}return this.handleWebKitEncrypted(t),e.abrupt("return");case 6:if(null===this.cdmSupport&&(this.cdmSupport=de(t.initData)),void 0!==this.mediaKeys){e.next=24;break}return this.mediaKeys=null,e.prev=9,e.next=12,this.createKeySystemSupportChain();case 12:return n=e.sent,this.selectedCDM=Y[n.keySystem],e.next=16,n.createMediaKeys();case 16:return i=e.sent,e.next=19,this.setMediaKeys(i);case 19:e.next=24;break;case 21:e.prev=21,e.t0=e.catch(9),this.handleError(e.t0);case 24:this.addSession(t);case 25:case"end":return e.stop()}}),e,this,[[9,21]])})));return function(t){return e.apply(this,arguments)}}(),t.setMediaKeys=function(e){var t=this;return this.mediaKeys=e,this.pendingSessions.forEach((function(e){return t.createSessionRequest(e).catch((function(){t.handleError(te)}))})),this.pendingSessions=[],this.video.setMediaKeys(this.mediaKeys)},t.addSession=function(e){var t=this;this.mediaKeys?this.createSessionRequest(e).catch((function(){t.handleError(te)})):this.pendingSessions.push(e)},t.createSessionRequest=function(e){var t,n=this,i=e.initDataType,r=e.initData,o=null==(t=this.mediaKeys)?void 0:t.createSession();return o?(o.addEventListener("message",(function(e){return n.handleMessage(e)})),o.addEventListener("keystatuseschange",(function(e){return n.handleKeyStatusesChange(e,r)})),o.generateRequest(i,r)):Promise.reject()},t.handleKeyStatusesChange=function(e,t){var n=this,i=e.target,r=!1;i.keyStatuses.forEach((function(e){switch(e){case"expired":r=!0;break;case"internal-error":n.handleError(ne)}})),r&&i.close().then((function(){return n.removeSession(t)}))},t.removeSession=function(e){for(var t=0;t<this.sessions.length;t++)if(this.sessions[t].initData===e)return void this.sessions.splice(t,1)},t.handleMessage=function(){var e=Ce()(Pe().mark((function e(t){var n,i,r=this;return Pe().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.target,e.next=3,this.generateLicense(t.message);case 3:(i=e.sent)&&n.update(i).catch((function(){r.handleError(z)}));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),t.generateLicense=function(){var e=Ce()(Pe().mark((function e(t){var n,i,r,o;return Pe().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.selectedCDM!==Q.CLEARKEY){e.next=5;break}return n=JSON.parse((new TextDecoder).decode(t)),i=n.kids.map((function(e){return{kty:"oct",alg:"A128KW",kid:e,k:e}})),r=(new TextEncoder).encode(JSON.stringify({keys:i})),e.abrupt("return",Promise.resolve(r));case 5:if(!this.authXml){e.next=10;break}return e.next=8,this.authXml;case 8:return o=e.sent,e.abrupt("return",this.requestLicense(t,o));case 10:this.handleError(re);case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),t.requestLicense=function(){var e=Ce()(Pe().mark((function e(t,n){var i,r,o,a=this;return Pe().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={method:"POST",responseType:"arraybuffer",body:t,headers:{customdata:n,"Content-Type":"application/octet-stream"}},this.selectedCDM===Q.PLAYREADY&&(o=Le(t),r.body=o.body,r.headers=Object.assign(r.headers,o.headers)),e.abrupt("return",le((null==(i=this.selectedCDM)?void 0:i.licenseUrl)||"",r).catch((function(e){var t;switch(e){case 0:t=J;break;case 404:t=$;break;case 403:t=Z;break;default:t=ee}a.handleError(Object.assign({code:e},t))})));case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),t.handleWebKitEncrypted=function(){var e=Ce()(Pe().mark((function e(t){var n,i=this;return Pe().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.selectedCDM=Q.FAIRPLAY,e.prev=1,e.next=4,le(Q.FAIRPLAY.certUrl||"",{method:"GET",responseType:"arraybuffer",headers:{Pragma:"Cache-Control: no-cache","Cache-Control":"max-age=0"}});case 4:n=e.sent,this.setupWebKitMediaKeys(t,n).catch((function(e){return i.handleError(e)})),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),this.handleError(Object.assign({code:e.t0},oe));case 11:case"end":return e.stop()}}),e,this,[[1,8]])})));return function(t){return e.apply(this,arguments)}}(),t.setupWebKitMediaKeys=function(e,t){var n=this;if(!e.initData)return Promise.reject("Missing initData on MediaEncryptedEvent");this.video.webkitKeys||this.video.webkitSetMediaKeys(new window.WebKitMediaKeys(Q.FAIRPLAY.keySystem));var i=he(e.initData),r=this.video.webkitKeys.createSession("video/mp4",e.initData);return r.contentId=i,new Promise((function(e,o){if(n.video.webkitKeys||o("Issue setting fairplay media keys"),!r)return o("Could not create key session");r.addEventListener("webkitkeymessage",(function(e){var r=e.target;"certificate"===String.fromCharCode.apply(null,e.message)?r.update(new Uint8Array(t)):n.getWebkitLicense(e.message,i).then((function(e){var t=e.trim();"<ckc>"===t.substr(0,5)&&"</ckc>"===t.substr(-6)&&(t=t.slice(5,-6)),r.update(pe(t))})).catch(o)})),r.addEventListener("webkitkeyadded",e),r.addEventListener("webkitkeyerror",o)}))},t.getWebkitLicense=function(e,t){return this.authXml?this.authXml.then((function(n){var i;return le(Q.FAIRPLAY.licenseUrl||"",{method:"POST",body:"spc="+(i=e,btoa(String.fromCharCode.apply(null,new Uint16Array(i)))+"&assetId=")+t,responseType:"text",headers:{"Content-Type":"application/x-www-form-urlencoded",customdata:n}}).catch((function(e){return Promise.reject(Object.assign({code:e},J))}))})):Promise.reject(re)},e}(),_e=require("@babel/runtime/helpers/inheritsLoose"),Ie=e.n(_e),Oe=function(){function e(){}var t=e.prototype;return t.addTrack=function(e){},t.bufferDuration=function(){return 0},t.buffered=function(){return{start:0,end:0}},t.getBufferedRanges=function(e){return[]},t.captureGesture=function(){},t.configure=function(e){},t.decodedFrames=function(){return 0},t.delete=function(){},t.droppedFrames=function(){return 0},t.endOfStream=function(){},t.enqueue=function(e){},t.framerate=function(){return 0},t.getCurrentTime=function(){return 0},t.getDisplayHeight=function(){return 0},t.getDisplayWidth=function(){return 0},t.getPlaybackRate=function(){return 0},t.getVolume=function(){return 0},t.invoke=function(e){this[e.name].call(this,e.arg)},t.isMuted=function(){return!1},t.onSourceDurationChanged=function(e){},t.pause=function(){},t.play=function(){},t.reinit=function(){},t.remove=function(e){},t.seekTo=function(e){},t.setMuted=function(e){},t.setPlaybackRate=function(e){},t.setTimestampOffset=function(e){},t.setVolume=function(e){},t.changeSrc=function(e){},t.changeSrcObj=function(e){},t.onSegmentDiscontinuity=function(){},e}(),Ne="pc-chromecast-sender",Ve=function(t){function n(e){var i;return(i=t.call(this)||this).remotePlayer=void 0,i.remotePlayerController=void 0,i.listener=void 0,i.seekTime=void 0,i.currentDuration=void 0,i.listener=e,i.currentDuration=0,n.prepareCastContext().then((function(){i.remotePlayer=new cast.framework.RemotePlayer,i.remotePlayerController=new cast.framework.RemotePlayerController(i.remotePlayer)})).catch((function(){i.listener.onSessionError()})),i}Ie()(n,t),n.canCast=function(){return I().chrome},n.stopLookingForRemotePlaybackDevices=function(e){window.cast&&window.cast.framework&&cast.framework.CastContext.getInstance().removeEventListener(cast.framework.CastContextEventType.CAST_STATE_CHANGED,e)},n.lookForRemotePlaybackDevices=function(){var e=Ce()(Pe().mark((function e(t){var i,r;return Pe().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n.prepareCastContext();case 3:return i=e.sent,r=function(e){switch(e.castState){case cast.framework.CastState.NO_DEVICES_AVAILABLE:break;case cast.framework.CastState.NOT_CONNECTED:t.onRemoteDevice(!0);break;case cast.framework.CastState.CONNECTED:var n=i.getCurrentSession();n&&n.getSessionState()===cast.framework.SessionState.SESSION_RESUMED&&t.onRemoteReconnect()}},i.addEventListener(cast.framework.CastContextEventType.CAST_STATE_CHANGED,r),i.setOptions({receiverApplicationId:"B3DCF968",autoJoinPolicy:chrome.cast.AutoJoinPolicy.TAB_AND_ORIGIN_SCOPED}),e.abrupt("return",r);case 10:e.prev=10,e.t0=e.catch(0),t.onRemoteDevice(!1);case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t){return e.apply(this,arguments)}}(),n.prepareCastContext=function(){var t=Ce()(Pe().mark((function t(){return Pe().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!window.cast||!window.cast.framework){t.next=2;break}return t.abrupt("return",Promise.resolve(cast.framework.CastContext.getInstance()));case 2:return t.abrupt("return",new Promise((function(t,n){if(e.g.__onGCastApiAvailable=function(e){e?t(cast.framework.CastContext.getInstance()):n()},!document.getElementById(Ne)){var i=document.createElement("script");i.id=Ne,i.onerror=function(){document.body.removeChild(i),e.g.__onGCastApiAvailable=function(){},n()},i.async=!0,i.src="https://www.gstatic.com/cv/js/sender/v1/cast_sender.js?loadCastFramework=1",document.body.appendChild(i)}})));case 3:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();var i=n.prototype;return i.configure=function(){var e=Ce()(Pe().mark((function e(t){var i,r,o,a,s,u,c;return Pe().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=t.path,e.prev=1,e.next=4,n.prepareCastContext();case 4:if(o=e.sent,a=o.getCurrentSession()){e.next=13;break}return e.next=9,o.requestSession();case 9:a=o.getCurrentSession(),this.setupRemotePlayerListeners(a),e.next=14;break;case 13:a.getSessionState()===cast.framework.SessionState.SESSION_RESUMED&&this.setupRemotePlayerListeners(a);case 14:return(s=new chrome.cast.media.MediaInfo(i,"")).streamType=chrome.cast.media.StreamType.BUFFERED,u=new chrome.cast.media.GenericMediaMetadata,s.metadata=u,s.customData={analytics:{chromecast_sender:"player-core",platform:"web"}},this.remotePlayerController.stop(),c=new chrome.cast.media.LoadRequest(s),this.seekTime>0&&(c.currentTime=this.seekTime,this.seekTime=0),this.currentDuration=0,e.next=25,null==(r=a)?void 0:r.loadMedia(c);case 25:e.next=30;break;case 27:return e.prev=27,e.t0=e.catch(1),e.abrupt("return",this.handleError(e.t0));case 30:case"end":return e.stop()}}),e,this,[[1,27]])})));return function(t){return e.apply(this,arguments)}}(),i.stopMedia=function(){var e=Ce()(Pe().mark((function e(t){var i,r;return Pe().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===t&&(t=!0),e.next=3,n.prepareCastContext();case 3:i=e.sent,(r=i.getCurrentSession())&&r.getSessionState()!==cast.framework.SessionState.SESSION_RESUMED&&r.endSession(t);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),i.invoke=function(e){this[e.name].call(this,e.arg)},i.play=function(){this.remotePlayer&&this.remotePlayer.isPaused&&this.remotePlayerController.playOrPause()},i.pause=function(){this.remotePlayer&&!this.remotePlayer.isPaused&&this.remotePlayerController.playOrPause()},i.seekTo=function(e){this.remotePlayer&&(this.remotePlayer.playerState!==chrome.cast.media.PlayerState.IDLE?(this.remotePlayer.currentTime=e,this.remotePlayerController.seek()):this.seekTime=e)},i.getCurrentTime=function(){return this.remotePlayer?this.remotePlayer.currentTime:0},i.delete=function(){this.remotePlayer&&this.stopMedia()},i.setMuted=function(e){this.remotePlayer&&e!==this.remotePlayer.isMuted&&this.remotePlayerController.muteOrUnmute()},i.isMuted=function(){return!!this.remotePlayer&&this.remotePlayer.isMuted},i.setVolume=function(e){this.remotePlayer&&(this.remotePlayer.volumeLevel=e,this.remotePlayerController.setVolumeLevel())},i.getVolume=function(){return this.remotePlayer?this.remotePlayer.volumeLevel:0},i.getDevice=function(){var e=Ce()(Pe().mark((function e(){var t,i;return Pe().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.prepareCastContext();case 2:return t=e.sent,i=t.getCurrentSession(),e.abrupt("return",(null==i?void 0:i.getCastDevice().friendlyName)||"");case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),i.setupRemotePlayerListeners=function(e){var t=this,n=function(){var n=Ce()(Pe().mark((function n(){var i,r;return Pe().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:(i=e.getMediaSession())&&(r=i.media,0===t.currentDuration&&null===r.duration&&(t.currentDuration=1/0,t.listener.onSinkDurationChanged(t.currentDuration)),t.listener.onSinkTimeUpdate());case 2:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}(),i=function(){switch(t.remotePlayer.playerState){case chrome.cast.media.PlayerState.BUFFERING:t.listener.onSinkIdle();break;case chrome.cast.media.PlayerState.PLAYING:t.listener.onSinkPlaying(!1);break;case chrome.cast.media.PlayerState.IDLE:var n=e.getMediaSession();n&&n.idleReason===chrome.cast.media.IdleReason.FINISHED&&t.listener.onSinkEnded()}},r=function(){t.listener.onSinkVolumeChanged(t.remotePlayer.volumeLevel,!0)},o=function(){t.listener.onSinkMutedChanged(t.remotePlayer.isMuted)},a=function(){0!==t.remotePlayer.duration&&(t.currentDuration=t.remotePlayer.duration,t.listener.onSinkDurationChanged(t.currentDuration))},s=function(){t.remotePlayerController.removeEventListener(cast.framework.RemotePlayerEventType.CURRENT_TIME_CHANGED,n),t.remotePlayerController.removeEventListener(cast.framework.RemotePlayerEventType.PLAYER_STATE_CHANGED,i),t.remotePlayerController.removeEventListener(cast.framework.RemotePlayerEventType.VOLUME_LEVEL_CHANGED,r),t.remotePlayerController.removeEventListener(cast.framework.RemotePlayerEventType.IS_MUTED_CHANGED,o),t.remotePlayerController.removeEventListener(cast.framework.RemotePlayerEventType.DURATION_CHANGED,a),t.listener.onSessionStop()};e.addEventListener(cast.framework.SessionEventType.MEDIA_SESSION,(function(){t.remotePlayerController.addEventListener(cast.framework.RemotePlayerEventType.CURRENT_TIME_CHANGED,n),t.remotePlayerController.addEventListener(cast.framework.RemotePlayerEventType.PLAYER_STATE_CHANGED,i),t.remotePlayerController.addEventListener(cast.framework.RemotePlayerEventType.VOLUME_LEVEL_CHANGED,r),t.remotePlayerController.addEventListener(cast.framework.RemotePlayerEventType.IS_MUTED_CHANGED,o),t.remotePlayerController.addEventListener(cast.framework.RemotePlayerEventType.DURATION_CHANGED,a),t.listener.onSessionStarted(e.getCastDevice().friendlyName)}));var u=e.getSessionObj();u.addUpdateListener((function(){u.status===chrome.cast.SessionStatus.STOPPED&&s()})),u.addMediaListener(s)},i.handleError=function(e){if(chrome.cast)switch(e){case chrome.cast.ErrorCode.SESSION_ERROR:this.listener.onSessionError();break;case chrome.cast.ErrorCode.RECEIVER_UNAVAILABLE:this.listener.onRemoteDevice(!1);break;case chrome.cast.ErrorCode.LOAD_MEDIA_FAILED:this.listener.onLoadMediaError();break;case chrome.cast.ErrorCode.CANCEL:this.listener.onUserCancel();break;default:this.listener.onSinkError({value:1,code:0,message:"Error requesting chromecast session"})}else this.listener.onSinkError({value:1,code:0,message:"Error loading chromecast SDK"})},n}(Oe),xe=function(e){function t(t){var n;return(n=e.call(this)||this).video=void 0,n.video=t,n}Ie()(t,e);var n=t.prototype;return n.seekTo=function(e){this.video.currentTime=e},n.setPlaybackRate=function(e){this.video.playbackRate=e},n.setVolume=function(e){this.video.volume=e},n.getVolume=function(){return this.video.volume},n.isMuted=function(){return this.video.muted},n.setMuted=function(e){this.video.muted=e},n.getPlaybackRate=function(){return this.video.playbackRate},t}(Oe),Ue=function(){function e(e,t){this.muted=void 0,this.video=void 0,this.listener=void 0,this.unsubscribes=[],this.expectingMutedChanged=!1,this.expectingVolumeChanged=!1,this.expectedRateChange=void 0,this.video=e,this.listener=t,this.muted=e.muted,this.unsubscribes.push(b(e,"volumechange",this.volumeChange.bind(this))),this.unsubscribes.push(b(e,"ratechange",this.rateChange.bind(this)))}var t=e.prototype;return t.volumeChange=function(){var e=!this.expectingVolumeChanged;this.expectingMutedChanged=!1,this.expectingVolumeChanged=!1;var t=this.video.muted;this.muted!==t?(this.muted=t,this.listener.onSinkMutedChanged(t)):this.listener.onSinkVolumeChanged(this.video.volume,e)},t.rateChange=function(){this.video.playbackRate!==this.expectedRateChange&&this.listener.onSinkPlaybackRateChanged(this.video.playbackRate)},t.unsubscribe=function(){this.unsubscribes.forEach((function(e){return e()}))},t.onConfigure=function(){this.expectingVolumeChanged&&(this.listener.onSinkVolumeChanged(this.video.volume,!1),this.expectingVolumeChanged=!1),this.expectingMutedChanged&&(this.muted=this.video.muted,this.listener.onSinkMutedChanged(this.video.muted),this.expectingMutedChanged=!1),this.expectedRateChange=void 0},t.trackRPC=function(e){var t=e.name,n=e.arg;"setVolume"===t&&this.video.volume!==n?this.expectingVolumeChanged=!0:"setMuted"===t&&this.video.muted!==n?this.expectingMutedChanged=!0:"setPlaybackRate"===t&&this.video.playbackRate!==n&&(this.expectedRateChange=n)},e}(),Be=require("promise-polyfill"),He=e.n(Be),Fe=("undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==e.g?e.g:void 0).Promise||He(),Ge=require("@babel/runtime/helpers/assertThisInitialized"),We=e.n(Ge),je=function(e){function t(t,n){var i;return(i=e.call(this)||this).paused=!0,i.listener=void 0,i.video=void 0,i.unsubscribers=void 0,i.lastVolumeChangeEvent=void 0,i.video=t,i.listener=n,i.paused=!0,i.unsubscribers=[],i.addListener("volumechange",i.recordMuteChange.bind(We()(i))),i.recordMuteChange(),i}Ie()(t,e);var n=t.prototype;return n.pause=function(){this.paused=!0,this.video.pause()},n.setPlaybackRate=function(e){this.video.playbackRate=e},n.delete=function(){this.unsubscribers.forEach((function(e){return e()}))},n.addListener=function(e,t,n){void 0===n&&(n=this.video),this.unsubscribers.push(b(n,e,t))},n.recordMuteChange=function(){this.lastVolumeChangeEvent={time:this.video.currentTime,muted:this.video.muted}},n.checkStopped=function(e){return!this.video.paused||this.video.ended||this.video.error||this.paused||this.listener.onSinkStop(e||this.unmuteAutopause()),!1},n.unmuteAutopause=function(){var e=this.lastVolumeChangeEvent;return!this.video.muted&&!e.muted&&this.video.currentTime===e.time},t}(Oe),Ke=function(e){function t(t,n){var i;return(i=e.call(this,t,n)||this).onSinkIdle=void 0,i.intervalId=void 0,i.idle=void 0,i.lastPlayhead=void 0,i.lastBufferEnd=void 0,i.fps=void 0,i.lastDecodedFrames=void 0,i.lastTimeUpdate=void 0,i.idleTimeout=void 0,i.playAttempt=!1,i.seeking=!1,i.audioBufferList=void 0,i.awaitingAutoplayCompletion=!1,i.intervalId=0,i.idle=!0,i.lastPlayhead=0,i.lastBufferEnd=0,i.fps=0,i.lastDecodedFrames=0,i.lastTimeUpdate=performance.now(),i.idleTimeout=-1,i.audioBufferList=[],i.bindEvents(),i}Ie()(t,e);var n=t.prototype;return n.bindEvents=function(){var e=this;this.addListener("play",(function(){return e.onVideoPlay()})),this.addListener("pause",(function(){return e.onVideoPause()})),this.addListener("timeupdate",(function(){return e.onVideoTimeUpdate()})),this.addListener("ended",(function(){return e.onVideoEnded()})),this.addListener("error",(function(){return e.onVideoError()})),this.addListener("playing",(function(){return e.onVideoPlaying()})),this.addListener("seeking",(function(){return e.onVideoSeeking()}))},n.delete=function(){e.prototype.delete.call(this),this.audioBufferList=[],clearInterval(this.intervalId)},n.play=function(){this.paused=!1;for(var e=this.video.buffered,t=0,n=0;n<e.length;n++){var i=e.start(n);if(this.video.currentTime<=i){t=i;break}}this.video.currentTime<t&&(console.warn("Moving to buffered region",t,this.video.currentTime),this.listener.onSinkGapJump(t-this.video.currentTime),this.seekTo(t)),this.playInternal()},n.endOfStream=function(){this.idle=!1,clearTimeout(this.idleTimeout),this.idleTimeout=-1},n.framerate=function(){return this.fps},n.seekTo=function(e){this.video.seekable.length&&e!==this.video.currentTime&&(this.seeking=!0,this.video.currentTime=e)},n.addSourceBuffer=function(e,t){(t.indexOf("mp4a")>-1||t.indexOf("opus")>-1)&&(this.audioBufferList=[e])},n.clearSourceBuffers=function(){this.audioBufferList=[]},n.onIdle=function(){var e;this.listener.onSinkIdle(),null==(e=this.onSinkIdle)||e.call(this)},n.onVideoPlay=function(){var e=this;this.playAttempt?(this.lastPlayhead=this.video.currentTime,clearInterval(this.intervalId),this.intervalId=self.setInterval((function(){return e.heartbeat()}),m)):(this.pause(),this.listener.play()),this.playAttempt=!1},n.onVideoPause=function(){this.awaitingAutoplayCompletion||(this.checkStopped(!1),clearInterval(this.intervalId))},n.onVideoTimeUpdate=function(){clearTimeout(this.idleTimeout),this.idleTimeout=-1,this.updateFrameRate(),this.listener.onSinkTimeUpdate();var e=k(this.video.buffered,this.video.currentTime,h);this.checkBufferUpdate(e),this.updateIdle(e)},n.updateFrameRate=function(){var e=g(this.video),t=performance.now();this.fps=1e3*Math.max(e-this.lastDecodedFrames,0)/(t-this.lastTimeUpdate),this.lastDecodedFrames=e,this.lastTimeUpdate=t},n.onVideoEnded=function(){this.listener.onSinkEnded()},n.onVideoPlaying=function(){this.video.paused||this.listener.onSinkPlaying(this.paused)},n.onVideoSeeking=function(){this.seeking?this.seeking=!1:this.listener.seekTo(this.video.currentTime)},n.onVideoError=function(){var e,t,n=null!=(e=null==this||null==(t=this.video)?void 0:t.error)?e:{},i=n.code,r=void 0===i?-1:i,o=n.message,a=void 0===o?"":o;this.listener.onSinkError({value:r,code:r,message:a})},n.heartbeat=function(){var e=k(this.video.buffered,this.video.currentTime,h);if(this.video.paused)clearInterval(this.intervalId);else if(this.video.currentTime===this.lastPlayhead){var t=S(this.video.buffered,this.video.currentTime,h);t!==this.video.currentTime&&(this.audioBufferList.map((function(e){E("Audio Buffer",e.buffered)})),E("<video> Buffer",this.video.buffered),console.warn("jumping "+(t-this.video.currentTime)+"s gap, current position "+this.video.currentTime+", new position "+t),this.listener.onSinkGapJump(t-this.video.currentTime),this.seekTo(t)),this.updateIdle(e,t===this.video.currentTime)}else this.checkBufferUpdate(e),this.lastPlayhead=this.video.currentTime;this.videoDisplaySizeUpdate()},n.videoDisplaySizeUpdate=function(){var e=this.video.clientWidth*window.devicePixelRatio,t=this.video.clientHeight*window.devicePixelRatio;this.listener.onSinkVideoDisplaySizeChanged(e,t)},n.checkBufferUpdate=function(e){var t=e.end;t!==this.lastBufferEnd&&(this.lastBufferEnd=t,this.listener.onSinkBufferUpdate())},n.updateIdle=function(e,t){var n=this,i=e.end,r=void 0===i?0:i;void 0===t&&(t=!1);var o=this.video,a=o.buffered,s=o.currentTime;if(o.paused)this.idle=!0;else{var u=[r].concat(this.audioBufferList.map((function(e){return k(e.buffered,s,h).end}))),c=Math.max.apply(null,u);Number.isFinite(c)||(c=0);var d=a.length,l=d>0?a.end(d-1):r,f=c-s<h||t&&r>l;f&&!this.idle&&(console.warn("playhead",s,"max buffer",c,"max played",l),clearTimeout(this.idleTimeout),this.idleTimeout=self.setTimeout((function(){return n.onBufferingTimeout()}),v),this.onIdle()),this.idle=f}},n.onBufferingTimeout=function(){clearTimeout(this.idleTimeout),this.idleTimeout=-1,this.listener.onSinkError({value:o,code:o,message:"Buffering timeout"})},n.playInternal=function(){var e=this;this.playAttempt=!0,this.awaitingAutoplayCompletion=!0,Fe.resolve(this.video.play()).then((function(){e.awaitingAutoplayCompletion=!1})).catch((function(){e.playAttempt=!1,e.checkStopped(!0)}))},t}(je),qe=function(e){function t(t,n){var i;return(i=e.call(this)||this).listener=t,i.video=n,i.playbackMonitor=void 0,i.controlsObserver=void 0,i.playbackMonitor=new Ke(n,t),i.observeControlsChange(),i}Ie()(t,e);var n=t.prototype;return n.configure=function(e){var t=e.srcObj;this.video.srcObject||(this.video.srcObject=t)},n.invoke=function(e){this[e.name].call(this,e.arg)},n.play=function(){this.playbackMonitor.play()},n.pause=function(){this.playbackMonitor.pause()},n.seekTo=function(e){this.playbackMonitor.seekTo(e)},n.endOfStream=function(){this.playbackMonitor.endOfStream()},n.setVolume=function(e){this.video.volume!==e&&(this.video.volume=e)},n.getVolume=function(){return this.video.volume},n.isMuted=function(){return this.video.muted},n.setMuted=function(e){this.video.muted!==e&&(this.video.muted=e)},n.getDisplayWidth=function(){return this.video.clientWidth},n.getDisplayHeight=function(){return this.video.clientHeight},n.setPlaybackRate=function(e){this.playbackMonitor.setPlaybackRate(e)},n.getPlaybackRate=function(){return this.video.playbackRate},n.getCurrentTime=function(){return this.video.currentTime},n.buffered=function(){return k(this.video.buffered,this.video.currentTime,h)},n.bufferDuration=function(){var e=this.buffered(),t=e.start;return e.end-Math.max(t,this.video.currentTime)},n.decodedFrames=function(){return g(this.video)},n.droppedFrames=function(){return y(this.video)},n.framerate=function(){return this.playbackMonitor.framerate()},n.captureGesture=function(){this.playbackMonitor.play(),this.playbackMonitor.pause()},n.changeSrcObj=function(e){var t=this.video,n=t.playbackRate;t.srcObject=e,t.playbackRate=n},n.delete=function(){var e;this.playbackMonitor.delete(),this.video.srcObject=null,C(this.video),null==(e=this.controlsObserver)||e.disconnect()},n.observeControlsChange=function(){var e=this.listener,t=this.video;try{(this.controlsObserver=new MutationObserver((function(){e.onSinkControlsChanged(t.controls)}))).observe(t,{attributeFilter:["controls"]}),e.onSinkControlsChanged(t.controls)}catch(e){}},t}(Oe),Qe=function(){function e(e,t,n){void 0===n&&(n=new Ke(t,e)),this.listener=e,this.video=t,this.playbackMonitor=n,this.controlsObserver=void 0,this.mseSink=void 0,this.awaitSink=void 0,this.observeControlsChange(),this.awaitSink=void 0,b(t,"error",this.onVideoError.bind(this))}var t=e.prototype;return t.invoke=function(e){var t=this.awaitSink,n=this.mseSink;t&&n?["enqueue","addTrack","setTimestampOffset"].includes(e.name)?this.invokeAsync(e):this.invokeSync(e):t?this.invokeAsync(e):n&&this.invokeSync(e)},t.initSink=function(){var e=this,t=this.awaitSink;if(!this.mseSink&&!t){var n=A.create(this.onMediaSourceEnded.bind(this),this.onMediaSourceError.bind(this));this.awaitSink=new Fe((function(t,i){n.sink.then((function(n){e.handleCreateSuccess(n),t()})).catch((function(t){e.handleCreateError(t),i()}))})),this.changeSrc(URL.createObjectURL(n.ms))}},t.configure=function(e){var t=e.trackID,n=e.codec,i=e.group,r=e.isProtected;this.initSink(),this.awaitSink||!this.isContentProtectionChanging(e)&&!this.isChangingToFromAudioOnly(e)||this.queueNewSink(),this.invoke({name:"addTrack",arg:N()({},Ye,{trackID:t,codec:n,group:i,isProtected:r})})},t.queueNewSink=function(){var e=this;this.awaitSink=new Fe((function(t,n){e.deferUntilIdle().then((function(){var t=A.create(e.onMediaSourceEnded.bind(e),e.onMediaSourceError.bind(e));return e.changeSrc(URL.createObjectURL(t.ms)),t.sink})).then((function(n){e.destroyMSESink(),e.handleCreateSuccess(n),e.play(),t()})).catch((function(t){e.handleCreateError(t),n()}))}))},t.addTrack=function(e){var t=e.trackID,n=e.codec,i=e.group,r=e.isProtected,o=this.mseSink;try{var a=null==o?void 0:o.addTrack(t,n,i,r);a&&this.playbackMonitor.addSourceBuffer(a,n)}catch(e){this.handleCreateError(e)}},t.enqueue=function(e){var t,n=e.trackID,i=e.buffer;null==(t=this.mseSink)||t.append(n,i)},t.endOfStream=function(){var e,t=this;null==(e=this.mseSink)||e.scheduleUpdate().then((function(){return t.playbackMonitor.endOfStream()}))},t.setTimestampOffset=function(e){var t,n=e.trackID,i=e.offset;null==(t=this.mseSink)||t.setTimestampOffset(n,i)},t.onSourceDurationChanged=function(e){var t=this.mseSink,n=this.video;if(t){var i=t.duration,r=function(e,t,n){var i=e;return e===1/0||e===f?n?i=1/0:n||(i=f):e!==t&&(i=e),i}(e,i,n.controls);r!==i&&t.setDuration(r)}},t.play=function(){var e,t=this;null==(e=this.mseSink)||e.scheduleUpdate().then((function(){return t.playbackMonitor.play()}))},t.pause=function(){var e,t=this;null==(e=this.mseSink)||e.scheduleUpdate().then((function(){return t.playbackMonitor.pause()}))},t.remove=function(e){var t,n=e.start,i=e.end;null==(t=this.mseSink)||t.remove(n,i)},t.seekTo=function(e){var t=this.mseSink,n=this.playbackMonitor,i=this.video,r=k(i.buffered,i.currentTime,h),o=r.start,a=r.end;e>=o&&e<a?null==t||t.scheduleUpdate().then((function(){return n.seekTo(e)})):n.seekTo(e)},t.setVolume=function(e){this.video.volume!==e&&(this.video.volume=e)},t.getVolume=function(){return this.video.volume},t.isMuted=function(){return this.video.muted},t.setMuted=function(e){this.video.muted!==e&&(this.video.muted=e)},t.getDisplayWidth=function(){return this.video.clientWidth},t.getDisplayHeight=function(){return this.video.clientHeight},t.setPlaybackRate=function(e){this.playbackMonitor.setPlaybackRate(e)},t.getPlaybackRate=function(){return this.video.playbackRate},t.getCurrentTime=function(){return this.video.currentTime},t.buffered=function(){return k(this.video.buffered,this.video.currentTime,h)},t.getBufferedRanges=function(e){var t,n;return null!=(t=null==(n=this.mseSink)?void 0:n.getBufferedRanges(e))?t:[]},t.bufferDuration=function(){var e=this.buffered(),t=e.start;return e.end-Math.max(t,this.video.currentTime)},t.decodedFrames=function(){return g(this.video)},t.droppedFrames=function(){return y(this.video)},t.framerate=function(){return this.playbackMonitor.framerate()},t.captureGesture=function(){this.playbackMonitor.play(),this.playbackMonitor.pause()},t.changeSrc=function(e){!function(e,t){var n=e.playbackRate,i=e.src;i&&URL.revokeObjectURL(i),e.src=t,e.playbackRate=n}(this.video,e)},t.changeSrcObj=function(e){},t.delete=function(){var e;this.playbackMonitor.delete(),null==(e=this.controlsObserver)||e.disconnect(),this.destroyMSESink(),C(this.video)},t.invokeSync=function(e){this[e.name].call(this,e.arg)},t.invokeAsync=function(e){var t,n=this;null==(t=this.awaitSink)||t.then((function(){return n.invokeSync(e)})).catch((function(){}))},t.onMediaSourceEnded=function(){this.video.load(),this.listener.onSinkReset()},t.destroyMSESink=function(){var e=this,t=function(){e.mseSink&&e.mseSink.destroy(),e.awaitSink=void 0,e.mseSink=void 0};this.mseSink?t():this.awaitSink&&this.awaitSink.then((function(){return t()})),this.playbackMonitor&&this.playbackMonitor.clearSourceBuffers()},t.isContentProtectionChanging=function(e){var t,n;return(null!=(t=null==(n=this.mseSink)?void 0:n.isDrmProtected())&&t)!==e.isProtected},t.isChangingToFromAudioOnly=function(e){var t,n;return(null!=(t=null==(n=this.mseSink)?void 0:n.isAudioOnly())&&t)!==("audio_only"===e.group)},t.deferUntilIdle=function(){var e=this,t=this.mseSink,n=this.playbackMonitor;return new Fe((function(i){t&&!e.video.paused?n.onSinkIdle=function(){n.onSinkIdle=void 0,i()}:i()}))},t.handleCreateSuccess=function(e){this.mseSink=e,this.awaitSink=void 0,this.onSourceDurationChanged(f),this.mseSink.setLiveSeekableRange(0,f)},t.handleCreateError=function(e){this.listener.onSinkError({value:4,code:4,message:e.toString()})},t.onMediaSourceError=function(e,t,n,i){var r={value:e,code:t,message:n};i?this.listener.onSinkError(r):this.listener.onSinkRecoverableError(r)},t.onVideoError=function(){this.destroyMSESink()},t.observeControlsChange=function(){var e=this,t=this.video;try{(this.controlsObserver=new MutationObserver((function(){e.invoke({name:"onSourceDurationChanged",arg:t.duration})}))).observe(t,{attributeFilter:["controls"]})}catch(e){}},t.onSegmentDiscontinuity=function(){},e}(),Ye={trackID:0,codec:'codecs="magic"',mode:"mse",isProtected:!1,path:"",group:"",srcObj:null},Xe=require("events"),ze=function(){function e(){this.emitter=void 0,this.emitter=new Xe.EventEmitter}var t=e.prototype;return t.on=function(e,t){this.emitter.on(String(e),t)},t.removeListener=function(e,t){this.emitter.removeListener(String(e),t)},t.emit=function(e){for(var t,n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];(t=this.emitter).emit.apply(t,[String(e)].concat(i))},t.removeAllListeners=function(){this.emitter.removeAllListeners()},e}(),Je=function(e){return e.Pending="pending",e.Ready="ready",e.Configuring="configuring",e.Active="active",e.Error="error",e}({}),Ze=function(e){return e.Heartbeat="heartbeat",e.Configure="configure",e.Set_Log_Config="setLogConfig",e.Debug="debug",e.Destroy="destroy",e}({}),$e=function(e){return e.State_Changed="stateChanged",e.Manifest_Load_Analytics="manifestLoadAnalytics",e.Available_Segments="availableSegments",e}({});function et(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var tt={enabled:!1,levels:{debug:!0,log:!0,info:!0,warn:!0,error:!0}},nt=new ze,it=function(e){var t=e.name,n=function(e){if(tt.enabled&&tt.levels[e]){for(var n=(new Date).toTimeString().split(" ")[0],i=arguments.length,r=new Array(i>1?i-1:0),o=1;o<i;o++)r[o-1]=arguments[o];console[e].apply(console,[n+" - ("+t+")"].concat(r))}};return{debug:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return n.apply(void 0,["debug"].concat(t))},log:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return n.apply(void 0,["log"].concat(t))},info:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return n.apply(void 0,["info"].concat(t))},warn:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return n.apply(void 0,["warn"].concat(t))},error:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return n.apply(void 0,["error"].concat(t))}}},rt=it({name:"sw-host-config"});function ot(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return at(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?at(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function at(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var st,ut=it({name:"sw-host"}),ct=function(){return st},dt=function(e){return e[e.Pending=0]="Pending",e[e.Installing=1]="Installing",e[e.Ready=2]="Ready",e[e.Error=3]="Error",e}(dt||{}),lt=function(e){var t,n=function(){return{isMSESupported:F()}};if(((t=e)?t.url||(rt.error("Service worker config must specify a url"),0):(rt.error("Service worker config is required"),0))&&function(e,t){return!(!t.forceActivate&&e.isMSESupported)}(n(),e)){var i,r,o,a,s,u,c,d,l,h,f,v,m,p,g,y,E,k,S,b,C,T,P,A=new ze,D=!0,L=dt.Pending,M=[],w=[],R=[],_=Je.Pending,I=!1,O=function(){var t=Ce()(Pe().mark((function t(){var n,i;return Pe().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,U(dt.Installing),navigator.serviceWorker.addEventListener("message",H),t.prev=3,t.next=6,V(e.url);case 6:t.next=11;break;case 8:t.prev=8,t.t0=t.catch(3),ut.error("[registerAndActivate] Failed to unregister service worker instances: "+t.t0);case 11:return n=void 0!==e.scope?{scope:e.scope}:void 0,t.next=14,navigator.serviceWorker.register(e.url,n);case 14:return(i=t.sent).installing?ut.log("Service worker installing"):i.waiting?ut.log("Service worker installed"):i.active&&ut.log("Service worker active"),t.next=18,x(i);case 18:U(dt.Ready),t.next=25;break;case 21:t.prev=21,t.t1=t.catch(0),ut.error("Registration failed with "+t.t1),U(dt.Error);case 25:case"end":return t.stop()}}),t,null,[[0,21],[3,8]])})));return function(){return t.apply(this,arguments)}}(),V=function(){var e=Ce()(Pe().mark((function e(t){var n;return Pe().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new RegExp(t),e.next=3,navigator.serviceWorker.getRegistrations().then(function(){var e=Ce()(Pe().mark((function e(t){var i,r,o;return Pe().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:ut.debug("[unregisterOtherWorkerInstances] registrations",t),i=ot(t);case 2:if((r=i()).done){e.next=16;break}if(null===(o=r.value).active||!n.test(o.active.scriptURL)){e.next=14;break}return ut.debug("[unregisterOtherWorkerInstances] unregistering:",o),e.prev=6,e.next=9,o.unregister();case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(6),ut.error("[unregisterOtherWorkerInstances] Failed to unregister service worker: "+e.t0);case 14:e.next=2;break;case 16:case"end":return e.stop()}}),e,null,[[6,11]])})));return function(t){return e.apply(this,arguments)}}());case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),x=function(){var e=Ce()(Pe().mark((function e(t){return Pe().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){null!==t.installing||null!==t.waiting?(t.installing||t.waiting).addEventListener("statechange",(function(t){var i=t.target;ut.debug("sw registration, statechange",i.state),"activated"===i.state?(ut.log("Service worker activated"),e()):"redundant"===i.state&&n()})):e()})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),U=function(e){if(ut.log("[changeHostState] host state changed from "+L+" to "+e),(L=e)===dt.Ready){var t=M.slice();M=[];for(var n,i=ot(t);!(n=i()).done;)(0,n.value)();var r=w.slice();w=[];for(var o,a=ot(r);!(o=a()).done;){var s=o.value;G(s)}}else if(L===dt.Error){var u=R.slice();R=[];for(var c,d=ot(u);!(c=d()).done;)(0,c.value)()}},B=function(e){L===dt.Error?e():R.push(e)},H=function(e){var t=e.data;switch(t.type){case $e.State_Changed:var n=t.state;_===Je.Configuring&&(I=!1),n===Je.Ready&&_!==Je.Pending&&ut.warn("[handleMessage] worker was restarted by the browser"),_=n;break;case $e.Manifest_Load_Analytics:ut.debug("Manifest_Load_Analytics",t)}A.emit(t.type,t)},G=function(){var e=Ce()(Pe().mark((function e(t){var n;return Pe().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return ut.log("[sendMessage] sending message: ",t),e.abrupt("return",null==(n=navigator.serviceWorker.controller)?void 0:n.postMessage(t));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),W=function(){var e=Ce()(Pe().mark((function e(t){return Pe().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(_!==Je.Pending){e.next=4;break}return ut.log("[sendMessageWhenReady] worker is not ready, queueing message",t),w.push(t),e.abrupt("return");case 4:G(t);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),j=function(){r&&clearTimeout(r),r=setTimeout((function(){K()}),1e4)},K=function(){D&&_!==Je.Pending&&(G({type:Ze.Heartbeat}),j())},q=function(e,t){A.on($e.State_Changed,(function n(i){i.type===$e.State_Changed&&i.state===e&&(A.removeListener($e.State_Changed,n),t(i))}))},Q=function(){var e=Ce()(Pe().mark((function e(){return Pe().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(L!==dt.Ready){e.next=2;break}return e.abrupt("return");case 2:return e.abrupt("return",new Promise((function(e,t){var n;n=function(){ut.log("[ensureHostReady] host state changed to ready"),e()},L===dt.Ready?n():M.push(n),B((function(){ut.log("[ensureHostReady] host state changed to error"),t()}))})));case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Y=function(){var e=Ce()(Pe().mark((function e(){return Pe().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(_===Je.Pending){e.next=2;break}return e.abrupt("return");case 2:return e.abrupt("return",new Promise((function(e,t){q(Je.Ready,(function(t){ut.log("[ensureWorkerReady] worker state changed to ready",t),e()}))})));case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),X=function(){var e=Ce()(Pe().mark((function e(){return Pe().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Q();case 2:return e.next=4,Y();case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),z=function(){var e=Ce()(Pe().mark((function e(t){return Pe().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return I=!0,i=J(null!=t?t:{}),e.next=4,X();case 4:G({type:Ze.Configure,config:i});case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),J=function(e){return N()({},i,e)},Z=function(){var e=Ce()(Pe().mark((function e(){return Pe().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(I||_!==Je.Active){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,X();case 4:return e.abrupt("return",new Promise((function(e,t){q(Je.Active,(function(t){ut.log("[ensureConfigured] worker state changed to active",t),e()}))})));case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),$=function(e){W({type:Ze.Set_Log_Config,config:e})};return P=n().isMSESupported?{cacheMultivariant:!1,transformTargetDuration:!1,lowLatencyMode:{enabled:!1,useLocalSegment:!1,convertPrefetchSegment:!1,preloadPrefetchSegments:!1},driftDetection:{enabled:!1,maxPlaylistPosition:0,triggerDetectionThreshold:0,minDurationBetweenCorrections:0},debug:{addMultivariantDelay:void 0,addFirstVariantDelay:void 0}}:{cacheMultivariant:!0,transformTargetDuration:!1,lowLatencyMode:{enabled:!0,useLocalSegment:!0,convertPrefetchSegment:!0,preloadPrefetchSegments:!1},driftDetection:{enabled:!0,maxPlaylistPosition:3,triggerDetectionThreshold:10,minDurationBetweenCorrections:60},debug:{addMultivariantDelay:void 0,addFirstVariantDelay:void 0}},i={cacheMultivariant:null!=(o=e.cacheMultivariant)?o:P.cacheMultivariant,transformTargetDuration:null!=(a=e.transformTargetDuration)?a:P.transformTargetDuration,lowLatencyMode:{enabled:null!=(s=null==(u=e.lowLatencyMode)?void 0:u.enabled)?s:P.lowLatencyMode.enabled,useLocalSegment:null!=(c=null==(d=e.lowLatencyMode)?void 0:d.useLocalSegment)?c:P.lowLatencyMode.useLocalSegment,convertPrefetchSegment:null!=(l=null==(h=e.lowLatencyMode)?void 0:h.convertPrefetchSegment)?l:P.lowLatencyMode.convertPrefetchSegment,preloadPrefetchSegments:null!=(f=null==(v=e.lowLatencyMode)?void 0:v.preloadPrefetchSegments)?f:P.lowLatencyMode.preloadPrefetchSegments},driftDetection:{enabled:null!=(m=null==(p=e.driftDetection)?void 0:p.enabled)?m:P.driftDetection.enabled,maxPlaylistPosition:null!=(g=null==(y=e.driftDetection)?void 0:y.maxPlaylistPosition)?g:P.driftDetection.maxPlaylistPosition,triggerDetectionThreshold:null!=(E=null==(k=e.driftDetection)?void 0:k.triggerDetectionThreshold)?E:P.driftDetection.triggerDetectionThreshold,minDurationBetweenCorrections:null!=(S=null==(b=e.driftDetection)?void 0:b.minDurationBetweenCorrections)?S:P.driftDetection.minDurationBetweenCorrections},debug:{addMultivariantDelay:null==(C=e.debug)?void 0:C.addMultivariantDelay,addFirstVariantDelay:null==(T=e.debug)?void 0:T.addFirstVariantDelay}},ut.info("[init] instantiating with config",i),void 0!==e.debug&&(e.debug.api={delayNextMediaManifest:function(e){!function(e){if("delayNextMediaManifest"===e.api){var t=e.delayInMs;ut.log("[handleDebugApiMessage] delaying next manifest by "+t+"ms")}G(N()({type:Ze.Debug},e))}({api:"delayNextMediaManifest",delayInMs:e})}}),nt.on("logConfigUpdated",$),j(),{registerAndActivate:O,addListener:function(e,t){A.on(e,t)},removeListener:function(e,t){A.removeListener(e,t)},sendMessage:G,ensureReady:X,configure:z,ensureConfigured:Z,getConfig:function(){return i},getDriftDetectionConfig:function(){var e;return null==(e=i)?void 0:e.driftDetection},setLogConfig:$,destroy:function(){ut.log("[destroy] destroying"),D=!1,r&&clearTimeout(r),A.removeAllListeners(),nt.removeListener("logConfigUpdated",$),navigator.serviceWorker.removeEventListener("message",H),G({type:Ze.Destroy})},debugPassthroughAnalytics:function(t){var n;null==(n=e.debug)||null==n.onPassthroughAnalytics||n.onPassthroughAnalytics(t)}}}},ht=function(){function e(){this.serverOffsetVal=e.SERVER_OFFSET_DEFAULT,this.liveLatencyVal=0,this.lastTranscodeReceive=-1}var t=e.prototype;return t.tryGenerateServerOffset=function(t){return this.serverOffsetVal!==e.SERVER_OFFSET_DEFAULT?(console.warn("[generateServerOffset] the server offset has already been generated, skipping"),!1):(this.serverOffsetVal=function(e,t){return new Date(1e3*t).getTime()-e}(Date.now(),t),!0)},t.tryUpdateLatency=function(t){return this.serverOffsetVal!==e.SERVER_OFFSET_DEFAULT&&(t<this.lastTranscodeReceive?(console.warn("[updateLatency] received latency values too old, ignoring. previous: "+this.lastTranscodeReceive+" current: "+t),!1):(this.liveLatencyVal=function(e,t,n){return(e+t-n)/1e3}(Date.now(),this.serverOffsetVal,t),this.lastTranscodeReceive=t,!0))},r()(e,[{key:"serverOffset",get:function(){return this.serverOffsetVal}},{key:"liveLatency",get:function(){return this.liveLatencyVal}}]),e}();ht.SERVER_OFFSET_DEFAULT=-1;var ft=function(e){var t=parseFloat(e);if(!isNaN(t))return t},vt=function(e){return e.Live_Latency_Load="liveLatencyLoad",e.Live_Latency_Stats="liveLatencyStats",e}({}),mt=function(e){return e.Trigger_Drift_Correction="triggerDriftCorrection",e}({}),pt=function(e){return e.ID3="org.id3",e.APPLE_HLS="com.apple.quicktime.HLS",e}(pt||{}),gt=function(e){return e.PRIV="PRIV",e.TXXX="TXXX",e.TDEN="TDEN",e.STREAM_LEVEL_SERVER_TIME="X-SERVER-TIME",e}(gt||{}),yt=it({name:"sink"}),Et=function(e){function t(t,n){var i;(i=e.call(this,n,t)||this).fps=void 0,i.intervalId=void 0,i.bufferingTimeoutId=void 0,i.attemptingToPlay=void 0,i.hasPlayedSrc=void 0,i.hasReloadedOnDecodeError=void 0,i.unsubscribersForTrackEvents=void 0,i.latencyStatistics=void 0,i.processedInitialCues=void 0,i.serviceWorker=void 0,i.serviceWorkerHandler=void 0,i.positionTracker=void 0,i.driftDetector=void 0,i.driftDetectorHandler=void 0,i.analytics=void 0,i.analyticsHandler=void 0,i.fps=0,i.intervalId=-1,i.bufferingTimeoutId=-1,i.attemptingToPlay=!1,i.hasPlayedSrc=!1,i.hasReloadedOnDecodeError=!1,i.unsubscribersForTrackEvents=[],i.latencyStatistics=new ht,i.processedInitialCues=!1,i.addListener("waiting",(function(){return i.onVideoWaiting()}),i.video),i.addListener("timeupdate",(function(){return i.onVideoTimeUpdate()}),i.video),i.addListener("durationchange",(function(){return i.onVideoDurationChange()}),i.video),i.addListener("error",(function(){return i.onVideoError()}),i.video),i.addListener("play",(function(){return i.onVideoPlay()}),i.video),i.addListener("pause",(function(){return i.onVideoPause()}),i.video),i.addListener("ended",(function(){return i.onVideoEnded()}),i.video),i.addListener("playing",(function(){return i.onVideoPlaying()}),i.video);var r,o,a,s,u,d,l,h,f,v,m,p,g,y,E=c(document).visibilityChange;if(i.addListener(E,(function(){return i.onVisibilityChange()}),document),i.serviceWorker=ct(),i.serviceWorkerHandler=function(e){return i.onServiceWorkerMessage(e)},i.addServiceWorkerListeners(),void 0!==i.serviceWorker){var k;i.positionTracker=(m=[],p=-1,g=function(){return 0===m.length||void 0===v?(p=-1,!1):-1!==(p=y(v))},y=function(e){var t=new RegExp("^"+e);if(m){var n=m.findIndex((function(e){return t.test(e.pdt)}));if(-1===n)for(var i=new Date(e+"Z"),r=0;r<m.length;r++){var o=m[r],a=new Date(o.pdt);if(a.getTime()<=i.getTime()&&a.getTime()+1e3*o.duration>i.getTime()){n=r;break}}if(-1!==n)return n}return console.warn("Couldn't find segment for PDT "+e),-1},{processAvailableSegments:function(e){return m=e,g()},processTDEN:function(e){return v=e,g()},getCurrentPosition:function(){return p}});var S=null==(k=i.serviceWorker)?void 0:k.getDriftDetectionConfig();void 0!==S&&S.enabled&&(i.driftDetector=(r={maxPlaylistPosition:S.maxPlaylistPosition,triggerDetectionThreshold:S.triggerDetectionThreshold,minDurationBetweenCorrections:S.minDurationBetweenCorrections},u=new ze,d=0,l=0,h=function(){if(void 0!==o&&void 0!==a)if(o<=r.maxPlaylistPosition)l=0;else if((l+=1)>r.triggerDetectionThreshold){console.debug("[handleDriftDetection] above detection threshold");var e=Date.now();(void 0===s||e-s>r.minDurationBetweenCorrections)&&(console.debug("[handleDriftDetection] within min duration, triggering rebuffer-to-live"),f(e,o,a))}},f=function(e,t,n){d+=1,s=e,l=0;var i={type:mt.Trigger_Drift_Correction,playlistPosition:t,playhead:n,rebufferCount:d};u.emit(mt.Trigger_Drift_Correction,i)},{addListener:function(e,t){u.on(e,t)},removeListener:function(e,t){u.removeListener(e,t)},processPlaylistPosition:function(e){o=e},processTimeUpdate:function(e){var t=Math.floor(e);void 0!==a&&t===a||(a=t,h())}}),i.driftDetectorHandler=function(e){return i.onDriftDetectorEvent(e)},i.addDriftDetectorListeners()),i.analytics=function(){var e,t,n,i,r=new ze,o={},a={duration:0},s={min:0,avg:0,max:0,last:0},u={first:void 0,last:void 0},c={count:0},d=function(){if((n=vt.Live_Latency_Load)===vt.Live_Latency_Load&&void 0===o[n]&&void 0!==e&&void 0!==t){var n,i=o[vt.Live_Latency_Load]||0;o[vt.Live_Latency_Load]=i+1,r.emit(vt.Live_Latency_Load,{type:vt.Live_Latency_Load,serverOffset:e,manifestLoadAnalytics:t})}},l=function(){var e=o[vt.Live_Latency_Stats]||0;o[vt.Live_Latency_Stats]=e+1,r.emit(vt.Live_Latency_Stats,{type:vt.Live_Latency_Stats,playlistPosition:N()({},s),liveLatencyTiming:N()({},u),driftCorrection:N()({},c)})};return{addListener:function(e,t){r.on(e,t)},removeListener:function(e,t){r.removeListener(e,t)},processServerOffset:function(t){e={serverTime:1e3*t.serverTime,clientTime:t.clientTime,serverOffset:t.serverOffset},d()},processManifestLoadAnalytics:function(e){t=e,d()},processSinkState:function(e){"playing"===n&&"pause"===e&&l(),n=e},processTimeUpdate:function(e){var t=Math.floor(e);void 0!==i&&t===i||(a.duration+=1,i=t,a.duration%10==0&&l())},processPlaylistPosition:function(e){e<s.min&&(s.min=e),e>s.max&&(s.max=e),0===s.avg?s.avg=e:s.avg=(s.avg*a.duration+e)/(a.duration+1),s.last=e},processLiveLatencyUpdate:function(e){void 0===u.first&&(u.first=N()({},e)),u.last=N()({},e)},processDriftCorrectionStart:function(){c.count+=1}}}(),i.analyticsHandler=function(e){return i.onAnalyticsEvent(e)},i.addAnalyticsListeners()}return i}Ie()(t,e);var n=t.prototype;return n.invoke=function(e){this[e.name].call(this,e.arg)},n.configure=function(e){var t=e.path;this.handleTrackEvents(),this.hasReloadedOnDecodeError=!1,this.hasPlayedSrc=!1,this.video.src=t},n.play=function(){var e=this,t=this.video.buffered;if(t.length>0){var n=t.start(t.length-1),i=t.end(t.length-1);this.video.duration===1/0&&(i<this.video.currentTime||this.video.currentTime<n)&&(this.listener.onSinkGapJump(n-this.video.currentTime),console.warn("Moving to buffered region"),this.video.currentTime=n)}this.paused=!1,this.attemptingToPlay=!0,(void 0===e.serviceWorker||e.hasPlayedSrc?Promise.resolve(e.video.play()):e.serviceWorker.ensureConfigured().catch((function(e){yt.warn("sw, ensureConfigured failed",e)})).then((function(){return Promise.resolve(e.video.play())}))).then((function(){e.attemptingToPlay=!1,e.hasPlayedSrc=!0})).catch((function(){e.attemptingToPlay=!1,e.checkStopped(!0)}))},n.pause=function(){e.prototype.pause.call(this),clearTimeout(this.intervalId)},n.seekTo=function(e){this.video.currentTime=e},n.setVolume=function(e){this.video.volume=e},n.getVolume=function(){return this.video.volume},n.buffered=function(){return k(this.video.buffered,this.video.currentTime,h)},n.decodedFrames=function(){return g(this.video)},n.droppedFrames=function(){return y(this.video)},n.framerate=function(){return this.fps},n.delete=function(){e.prototype.delete.call(this),this.removeTrackListeners(),this.removeServiceWorkerListeners(),this.removeDriftDetectorListeners(),this.removeAnalyticsListeners(),this.video.src="",this.video.load()},n.isMuted=function(){return this.video.muted},n.setMuted=function(e){this.video.muted=e},n.getDisplayWidth=function(){return this.video.clientWidth},n.getDisplayHeight=function(){return this.video.clientHeight},n.getPlaybackRate=function(){return this.video.playbackRate},n.getCurrentTime=function(){return this.video.currentTime},n.bufferDuration=function(){var e=this.buffered(),t=e.start;return e.end-Math.max(t,this.video.currentTime)},n.captureGesture=function(){Promise.resolve(this.video.play()).catch((function(){})),this.video.pause()},n.addServiceWorkerListeners=function(){void 0!==this.serviceWorker&&(this.serviceWorker.addListener($e.Manifest_Load_Analytics,this.serviceWorkerHandler),this.serviceWorker.addListener($e.Available_Segments,this.serviceWorkerHandler))},n.onServiceWorkerMessage=function(e){switch(e.type){case $e.Manifest_Load_Analytics:var t;null==(t=this.analytics)||t.processManifestLoadAnalytics(e.data);break;case $e.Available_Segments:var n;null==(n=this.positionTracker)||n.processAvailableSegments(e.segments)}},n.removeServiceWorkerListeners=function(){void 0!==this.serviceWorker&&(this.serviceWorker.removeListener($e.Manifest_Load_Analytics,this.serviceWorkerHandler),this.serviceWorker.removeListener($e.Available_Segments,this.serviceWorkerHandler))},n.addDriftDetectorListeners=function(){var e;null==(e=this.driftDetector)||e.addListener(mt.Trigger_Drift_Correction,this.driftDetectorHandler)},n.onDriftDetectorEvent=function(e){var t;e.type===mt.Trigger_Drift_Correction&&(yt.debug("triggering drift correction",e),null==(t=this.analytics)||t.processDriftCorrectionStart(),this.resumeAtLive())},n.resumeAtLive=function(){this.pause(),this.configure({path:this.video.src}),this.play()},n.removeDriftDetectorListeners=function(){var e;null==(e=this.driftDetector)||e.removeListener(mt.Trigger_Drift_Correction,this.driftDetectorHandler)},n.addAnalyticsListeners=function(){var e,t;null==(e=this.analytics)||e.addListener(vt.Live_Latency_Load,this.analyticsHandler),null==(t=this.analytics)||t.addListener(vt.Live_Latency_Stats,this.analyticsHandler)},n.onAnalyticsEvent=function(e){var t;switch(null==(t=this.serviceWorker)||t.debugPassthroughAnalytics(e),e.type){case vt.Live_Latency_Load:yt.debug("analytics event, Live Latency Load",e.serverOffset,e.manifestLoadAnalytics);break;case vt.Live_Latency_Stats:yt.debug("analytics event, Live Latency Stats",e.playlistPosition,e.liveLatencyTiming,e.driftCorrection)}},n.removeAnalyticsListeners=function(){var e,t;null==(e=this.analytics)||e.removeListener(vt.Live_Latency_Load,this.analyticsHandler),null==(t=this.analytics)||t.removeListener(vt.Live_Latency_Stats,this.analyticsHandler)},n.addTrackListener=function(e,t,n){this.unsubscribersForTrackEvents.push(b(n,e,t))},n.removeTrackListeners=function(){this.unsubscribersForTrackEvents.forEach((function(e){return e()}))},n.checkTracksStatus=function(){for(var e=this.video.textTracks,t=0;t<e.length;t++){var n=e[t];"metadata"===n.kind&&"disabled"===n.mode&&(n.mode="hidden")}},n.handleTDENDataReceived=function(e){if(void 0!==this.positionTracker&&this.positionTracker.processTDEN(e)){var t,n,i=this.positionTracker.getCurrentPosition();null==(t=this.analytics)||t.processPlaylistPosition(i),null==(n=this.driftDetector)||n.processPlaylistPosition(i)}},n.handleTXXXSegmentDataReceived=function(e){var t,n=function(e){var t=s(e);if("transc_r"in t)return{transc_r:parseInt(t.transc_r)}}(e);void 0!==n&&(n.transc_r>0&&this.listener.onPassthroughSinkPropertyChanged("transcodeReceiveInSecs",n.transc_r/1e3),this.latencyStatistics.tryUpdateLatency(n.transc_r)&&(this.listener.onPassthroughSinkPropertyChanged("liveLatency",this.latencyStatistics.liveLatency),null==(t=this.analytics)||t.processLiveLatencyUpdate({transc_r:n.transc_r,latency:this.latencyStatistics.liveLatency})))},n.handleInitialCues=function(e){for(var t,n,i=0;i<e.length;++i){var r=e[i];r.type===pt.APPLE_HLS&&r.value.key===gt.STREAM_LEVEL_SERVER_TIME&&(t=ft(r.value.data))}this.processedInitialCues=!0,void 0!==t&&this.latencyStatistics.tryGenerateServerOffset(t)&&(null==(n=this.analytics)||n.processServerOffset({serverTime:t,clientTime:Date.now(),serverOffset:this.latencyStatistics.serverOffset}))},n.shouldPropagateCue=function(e){var t=e.type,n=e.value;return!(t!==pt.ID3||!n||!(n.key===gt.TXXX&&"segmentmetadata"!==n.info||n.key===gt.PRIV&&n.info===Ee.METADATA_ID||n.key===gt.PRIV&&n.info===Ee.INBAND_METADATA_ID))},n.handleCueChange=function(e){var t=this,n=new Set;this.addTrackListener("cuechange",(function(){var i;!t.processedInitialCues&&e.cues&&t.handleInitialCues(e.cues);var r=null!=(i=e.activeCues)?i:[];if(r.length>0){for(var o=new Set,a=0;a<r.length;++a){var s=r[a];if(!n.has(s)){s.type;var u=s.value;if(u.key===gt.TXXX&&"segmentmetadata"===u.info&&t.handleTXXXSegmentDataReceived(u.data),u.key===gt.TDEN&&t.handleTDENDataReceived(u.data),t.shouldPropagateCue(s)){var c=u.key===gt.PRIV?new TextDecoder("utf-8").decode(u.data):u.data||"",d=u.info||"";t.listener.onPassthroughSinkMetadata(s.startTime,s.endTime,c,d,d)}}o.add(s)}n=o}}),e)},n.handleTrackEvents=function(){var e=this;this.removeTrackListeners(),void 0===window.DataCue&&void 0===window.WebKitDataCue||(this.addTrackListener("change",(function(){e.checkTracksStatus()}),this.video.textTracks),this.addTrackListener("addtrack",(function(t){var n=t.track;"metadata"===n.kind&&"disabled"===n.mode&&(n.mode="hidden",e.handleCueChange(n))}),this.video.textTracks))},n.onVideoWaiting=function(){var e=this;if(k(this.video.buffered,this.video.currentTime,h).end-this.video.currentTime<h){this.listener.onSinkIdle(),clearTimeout(this.bufferingTimeoutId),this.bufferingTimeoutId=self.setTimeout((function(){e.listener.onSinkError({value:o,code:o,message:"Buffering timeout"})}),v);var t=b(this.video,"timeupdate",(function(){t(),clearTimeout(e.bufferingTimeoutId)}))}var n=b(this.video,"timeupdate",(function(){4===e.video.readyState&&(n(),e.onVideoPlaying())}))},n.onVideoTimeUpdate=function(){var e,t,n=this.listener,i=this.video;n.onSinkTimeUpdate(),n.onSinkVideoDisplaySizeChanged(i.clientWidth*self.devicePixelRatio,i.clientHeight*self.devicePixelRatio),null==(e=this.analytics)||e.processTimeUpdate(this.getCurrentTime()),null==(t=this.driftDetector)||t.processTimeUpdate(this.getCurrentTime())},n.onVideoDurationChange=function(){this.listener.onSinkDurationChanged(this.video.duration)},n.onVideoError=function(){var e=this.video.error,t=e.code,n=e.message,i=void 0===n?"":n,r=-1!==this.video.src.indexOf(".m3u8");if(4===t&&!this.hasPlayedSrc&&r)return clearTimeout(this.bufferingTimeoutId),void this.listener.onSinkError({value:404,code:404,message:i});3!==t||this.hasReloadedOnDecodeError?this.listener.onSinkError({value:t,code:t,message:i}):this.hasReloadedOnDecodeError||(this.hasReloadedOnDecodeError=!0,console.warn("Reload video element on MEDIA_ERR_DECODE 3"),this.video.load())},n.onVideoPlay=function(){var e=this,t=this.video.currentTime;clearTimeout(this.intervalId),this.intervalId=self.setTimeout((function(){return e.heartbeat(t)}),m)},n.onVideoPause=function(){var e;clearTimeout(this.intervalId),this.attemptingToPlay||(null==(e=this.analytics)||e.processSinkState("pause"),this.checkStopped(!1))},n.onVideoEnded=function(){this.listener.onSinkEnded()},n.onVideoPlaying=function(){var e;null==(e=this.analytics)||e.processSinkState("playing"),this.listener.onSinkPlaying(this.paused),this.trackFPS(g(this.video),performance.now()),this.trackBufferUpdate(k(this.video.buffered,this.video.currentTime,h).end)},n.onVisibilityChange=function(){var e=c(document).hidden;document[e]&&(this.hasReloadedOnDecodeError=!1)},n.heartbeat=function(e){var t,n,i,r=this,o=this.video.currentTime;if(o===e){if(t=this.video,h,i=k(t.buffered,t.currentTime,.1).end-(n=t.currentTime),!(t.ended||t.duration-n<.1)&&i<.1)return void this.listener.onSinkIdle();var a=S(this.video.buffered,o,h);a!==o&&(console.warn("jumping "+(a-o)+"s gap"),this.listener.onSinkGapJump(a-this.video.currentTime),this.video.currentTime=a,o=this.video.currentTime)}this.intervalId=self.setTimeout((function(){return r.heartbeat(o)}),m)},n.trackFPS=function(e,t){var n=this,i=g(this.video),r=performance.now();this.fps=(i-e)/(r-t)*1e3;var o=b(this.video,"timeupdate",(function(){o(),n.trackFPS(i,r)}))},n.trackBufferUpdate=function(e){var t=this,n=this.buffered().end;n!==e&&this.listener.onSinkBufferUpdate();var i=b(this.video,"timeupdate",(function(){i(),t.trackBufferUpdate(n)}))},t}(je),kt=function(e){function t(){return e.apply(this,arguments)||this}return Ie()(t,e),t.prototype.onIdle=function(){this.onSinkIdle?this.onSinkIdle():this.listener.onSinkIdle()},t}(Ke),St=function(e){function t(t,n,i){var r;return(r=e.call(this,t,n,new kt(n,t))||this).listener=t,r.video=n,r.adjustments=i,r}Ie()(t,e);var n=t.prototype;return n.configure=function(e){var t=e.trackID,n=e.codec,i=e.group,r=e.isProtected;if(this.initSink(),this.isContentProtectionChanging(e)&&this.queueNewSink(),this.isNewSinkNeeded(e)){this.queueNewSink();var o=this.getTrack(p.audio);o&&this.invoke({name:"addTrack",arg:o})}this.invoke({name:"addTrack",arg:N()({},bt,{trackID:t,codec:n,group:i,isProtected:r})})},n.queueNewSink=function(){var e=this;this.awaitSink=new Promise((function(t,n){e.deferUntilIdle().then((function(){var t=A.create(e.onMediaSourceEnded.bind(e),e.onMediaSourceError.bind(e));return e.changeSrc(URL.createObjectURL(t.ms)),t.sink})).then((function(n){e.invokeAsync({name:"play",arg:void 0}),e.destroyMSESink(),e.handleCreateSuccess(n),t()})).catch((function(t){e.handleCreateError(t),n()}))}))},n.deferUntilIdle=function(){var e=this,t=this.mseSink,n=this.playbackMonitor;return new Promise((function(i){t&&!e.video.paused?(n.onSinkIdle=function(){},e.video.addEventListener("waiting",(function(){n.onSinkIdle=void 0,i()}),{once:!0})):i()}))},n.onSegmentDiscontinuity=function(){var e=this.adjustments,t=this.awaitSink,n=this.mseSink;e.rebuildMediaSinkOnDiscontinuity&&n&&!t&&this.queueNewSink()},n.isSinkVideoSourceQualityChangeRequired=function(e,t){return!!this.adjustments.rebuildMediaSinkOnSourceQualityChange&&"chunked"===e!=("chunked"===t)},n.isNewSinkNeeded=function(e){var t=this.adjustments,n=this.mseSink,i=this.awaitSink;if(e.trackID!==p.video)return!1;if(!t.rebuildMediaSinkOnSourceQualityChange)return!1;if(!n||i)return!1;var r=this.getTrack(p.video),o=this.getTrack(p.audio);return!(!r||!o)&&this.isSinkVideoSourceQualityChangeRequired(r.group,e.group)},n.getTrack=function(e){var t,n=this.mseSink;return null!=(t=null==n?void 0:n.bufferProperties.find((function(t){return t.trackID===e})))?t:null},t}(Qe),bt={trackID:0,codec:'codecs="magic"',mode:"mse",isProtected:!1,path:"",group:"",srcObj:null},Ct=function(){function e(e,t,n,i){this.listener=e,this.adjustments=n,this.video=void 0,this.drmManager=void 0,this.codecs=void 0,this.sink=void 0,this.observer=void 0,this.remoteDevicesListener=void 0,this.video=i||document.createElement("video"),this.listener=e,this.drmManager=new Re({video:this.video,listener:e}),this.codecs=Object.create(null),this.sink=new xe(this.video),t&&(this.remoteDevicesListener=Ve.lookForRemotePlaybackDevices(this.listener)),this.observer=new Ue(this.video,e)}var t=e.prototype;return t.delete=function(){var e;this.reset(),null==(e=this.remoteDevicesListener)||e.then((function(e){e&&Ve.stopLookingForRemotePlaybackDevices(e)}))},t.configure=function(e){var t=e.mode,n=e.codec,i=e.trackID;this.sink instanceof xe&&(this.sink=this.getSink(t)),n?this.codecs[i]=n:e.codec=this.codecs[i],this.sink.configure(e);var r=e.path,o=e.isProtected;r&&o&&this.drmManager.configure(r),this.observer.onConfigure()},t.applyRPC=function(e){this.observer.trackRPC(e),this.sink.invoke(e)},t.getCurrentSink=function(){return this.sink},t.reset=function(){this.sink.delete(),this.drmManager.reset(),this.sink=new xe(this.video),this.listener.onSinkTimeUpdate(),this.listener.onSinkBufferUpdate()},t.videoElement=function(){return this.video},t.isProtected=function(){return this.drmManager.isProtected()},t.captureGesture=function(){this.video.played.length||this.sink.captureGesture()},t.destroy=function(){this.observer.unsubscribe(),this.delete()},t.isLowLatencyCapable=function(){return this.sink instanceof Qe},t.onSegmentDiscontinuity=function(){this.sink.onSegmentDiscontinuity()},t.getSink=function(e){switch(e){case"chromecast":return new Ve(this.listener);case"mse-worker":return new qe(this.listener,this.video);case"passthrough":return new Et(this.listener,this.video);case"webview":return new St(this.listener,this.video,this.adjustments);default:return new Qe(this.listener,this.video)}},e}(),Tt=function(e){return e[e.STATE_CHANGED=0]="STATE_CHANGED",e[e.CONFIGURE=1]="CONFIGURE",e[e.RESET=2]="RESET",e[e.ADD_CUE=3]="ADD_CUE",e[e.GET_DECODE_INFO=4]="GET_DECODE_INFO",e[e.MEDIA_SINK_RPC=5]="MEDIA_SINK_RPC",e[e.GET_EXPERIMENTS=6]="GET_EXPERIMENTS",e[e.LOG_MESSAGE=7]="LOG_MESSAGE",e[e.DATA_CHANNEL_CREATE=8]="DATA_CHANNEL_CREATE",e[e.DATA_CHANNEL_CLOSE=9]="DATA_CHANNEL_CLOSE",e[e.DATA_CHANNEL_SEND=10]="DATA_CHANNEL_SEND",e[e.RTC_SET_REMOTE_DESCRIPTION=11]="RTC_SET_REMOTE_DESCRIPTION",e[e.PROPERTY_CHANGED=12]="PROPERTY_CHANGED",e[e.SYNC_TIME_CHANGED=13]="SYNC_TIME_CHANGED",e[e.BUFFERED_RANGES=14]="BUFFERED_RANGES",e[e.DESTROY=15]="DESTROY",e}({}),Pt={rebuildMediaSinkOnSourceQualityChange:!1,rebuildMediaSinkOnDiscontinuity:!1,abrTranscodesOnly:!1},At=function(e){return e.AVC="avc1",e.HEVC="hvc1",e.AV1="av01",e}({}),Dt=function(e){return e.HEVC="b8b7cac6-956d-4819-8d35-9ae57aa5f0ce",e.AV1="d16629fa-a0bf-4a2a-b490-c1f92af05009",e.GPU="8b0cb43a-720b-4775-9f98-21da360d60b1",e}({}),Lt=function(){function e(e,t){var n;if(void 0===e&&(e={}),this.onConfigChanged=t,this.mainConfig=void 0,this.experimentHandler=void 0,this.resetMainConfig(),this.setupExperimentHandlers(),e.logLevel&&(this.mainConfig.logLevel=e.logLevel),e.media&&Object.assign(this.mainConfig.media,e.media),e.features&&(Object.assign(this.mainConfig.features,e.features),e.features.gpu&&Object.assign(null!=(n=this.mainConfig.features.gpu)?n:{},e.features.gpu)),e.experiments)for(var i=0,r=Object.values(e.experiments);i<r.length;i++){var o=r[i];o&&this.setExperiment(o.id,o.assignment)}}var t=e.prototype;return t.setupExperimentHandlers=function(){var e=this,t=this.handleExperiment((function(){return e.mainConfig.media.codecConfigs}),wt,(function(t){var n=e.mainConfig.media.codecConfigs;e.mainConfig.media.codecConfigs=null==n?void 0:n.concat(t)})),n=this.handleExperiment((function(){return e.mainConfig.media.codecConfigs}),Rt,(function(t){var n=e.mainConfig.media.codecConfigs;e.mainConfig.media.codecConfigs=null==n?void 0:n.concat(t)})),i=this.handleExperiment((function(){return e.mainConfig.features.gpu}),(function(e,t){return Mt(t)}),(function(t){e.mainConfig.features.gpu=t}));this.experimentHandler=new Map([[Dt.HEVC,t],[Dt.AV1,n],[Dt.GPU,i]])},t.getConfigSnapshot=function(){return N()({},this.mainConfig)},t.setExperiment=function(e,t){var n;e&&t&&(this.mainConfig.experiments[e]={id:e,assignment:t,version:0},null==(n=this.experimentHandler.get(e))||n(t))},t.delete=function(){this.resetMainConfig()},t.resetMainConfig=function(){this.mainConfig={media:{codecConfigs:[]},logLevel:"",features:{},experiments:{}}},t.handleExperiment=function(e,t,n){var i=this;return function(r){var o=e(),a=t(o,r);a!==o&&(n(a),i.onConfigChanged())}},e}(),Mt=function(e){var t={};if(!e)return t;var n=e.split("+config="),i=(n[0],n[1]);if(!i)return t;try{t=JSON.parse(atob(i))}catch(t){console.warn("[ConfigManager]: Invalid assignment config provided",e,t)}return t};function wt(e,t){switch(t){case"control":case"holdback":return[{codecString:At.HEVC,setting:{disableUse:!0}}];case"forceOn":return[{codecString:At.HEVC,setting:{skipPlatformSupportChecks:!0}}];case"treatment":return[];default:return e}}function Rt(e,t){switch(t){case"control":case"holdback":return[{codecString:At.AV1,setting:{disableUse:!0}}];case"forceOn":return[{codecString:At.AV1,setting:{skipPlatformSupportChecks:!0}}];case"treatment":return[];default:return e}}var _t=function(){function e(t,n){var i,r,o=this;this.worker=void 0,this.id=void 0,this.emitter=new ze,this.seekTime=null,this.paused=!0,this.isLoaded=!1,this.autoPlayOptions=null,this.mediaSinkManager=void 0,this.experiments={},this.adjustments=void 0,this.enableRemoteSearch=void 0,this.isQualitySupported=void 0,this.onvisibilitychange=void 0,this.onmessage=function(e){return o.onWorkerMessage(e)},this.onOnline=function(){return o.postMessage("onOnline")},this.onOffline=function(){return o.postMessage("onOffline")},this.pauseHiddenSilentTab=void 0,this.state=void 0,this.workerMessageProcessors=[B],this.configManager=void 0,this.startCapture=void 0,this.stopCapture=void 0,this.requestCaptureAnalytics=void 0,this.worker=n,this.id=e.instanceId++,this.isQualitySupported=t.isQualitySupported||u,this.onvisibilitychange=function(){return o.onVisibilityChange()},this.enableRemoteSearch=t.enableRemoteSearch||!1;var a,s,c=I();if(this.pauseHiddenSilentTab=c.chrome&&63===c.major||c.opera,this.adjustments=(a=null!=(i=null==(r=t.webviewHost)?void 0:r.adjustments)?i:{},N()({},Pt,a)),this.mediaSinkManager=new Ct(this,this.enableRemoteSearch,this.adjustments),H.isSupported()){var d=new H;this.workerMessageProcessors.push(d.processor)}void 0!==t.serviceWorker&&("serviceWorker"in navigator||(ut.warn("Service workers are not supported."),0))&&(function(e){st=lt(e)}(t.serviceWorker),null==(s=ct())||s.registerAndActivate()),this.state={averageBitrate:0,bandwidthEstimate:0,looping:!1,autoQualityMode:!0,volume:1,liveLatency:0,liveLowLatencyEnabled:!0,liveLowLatency:!1,statistics:{}},this.resetState(),this.attachHandlers(),this.checkDebugCaptureEnabled();var l,h=[];l='video/mp4; codecs="hvc1.1.40000000.L60.80.0.0.0.0.0"',(F()?MediaSource.isTypeSupported(l):""!==document.createElement("video").canPlayType(l))&&h.push("hevc"),function(){var e='video/mp4; codecs="av01.0.05M.08"';return F()?MediaSource.isTypeSupported(e):""!==document.createElement("video").canPlayType(e)}()&&h.push("av01"),this.configManager=new Lt({},(function(){o.postMessage("updatePlayerConfiguration",[o.configManager.getConfigSnapshot()])})),this.postMessage("create",[{mseSupported:F(),keySystem:void 0!==t.keySystem?t.keySystem:se(c),browserContext:N()({},c,{webviewHost:t.webviewHost}),codecs:h,testOnly:t.testOnly,playerFramework:t.playerFramework,buildDistId:"npm"},this.configManager.getConfigSnapshot()])}var t=e.prototype;return t.delete=function(){var e,t=this;null==(e=ct())||e.destroy();var n=c(document).visibilityChange;document.removeEventListener(n,this.onvisibilitychange),window.removeEventListener("online",this.onOnline),window.removeEventListener("offline",this.onOffline),this.emitter.removeAllListeners(),this.emitter.on(Tt.DESTROY,(function(){t.mediaSinkManager.destroy(),t.emitter.removeAllListeners(),t.worker.removeEventListener("message",t.onmessage)})),this.configManager.delete(),this.postMessage("delete")},t.attachHTMLVideoElement=function(e){var t;null==(t=this.mediaSinkManager)||t.destroy(),this.mediaSinkManager=new Ct(this,this.enableRemoteSearch,this.adjustments,e),this.processVideoElementAttributes(e)},t.getHTMLVideoElement=function(){return this.mediaSinkManager.videoElement()},t.load=function(e,t){var n;void 0===t&&(t=""),null==(n=ct())||n.configure(),this.postMessage("load",[e,t]),this.autoPlayOptions&&this.postMessage("playIntent")},t.play=function(){this.postMessage("playIntent"),this.mediaSinkManager.captureGesture(),this.paused=!1,this.attemptPlay()},t.setAutoplay=function(e){this.autoPlayOptions=e?{attemptMutedRetry:!0}:null},t.setAutoPlayOptions=function(e){this.autoPlayOptions=e},t.getExperiments=function(){return this.experiments},t.setExperiment=function(e,t){this.configManager.setExperiment(e,t),this.setExperimentData({id:e,assignment:t,version:0,type:""})},t.setExperimentData=function(e){this.postMessage("setExperiment",[e])},t.pause=function(){this.paused=!0,this.postMessage("pause")},t.isPaused=function(){return this.paused},t.seekTo=function(e){this.seekTime=e,this.postMessage("seekTo",[e])},t.isSeeking=function(){return null!==this.seekTime},t.isAutoplay=function(){return!!this.autoPlayOptions},t.getDuration=function(){return this.state.duration},t.getStartOffset=function(){return this.state.startOffset||0},t.getPosition=function(){return null===this.seekTime?this.mediaSinkManager.getCurrentSink().getCurrentTime():this.seekTime},t.getSyncTime=function(){return this.state.syncTime},t.getBuffered=function(){return this.mediaSinkManager.getCurrentSink().buffered()},t.getBufferedRanges=function(){return this.postMessage("updateBufferedRanges",[]),this.state.trackBufferedRanges},t.getSinkBufferedRanges=function(){var e=this.mediaSinkManager.getCurrentSink();return{audio:e.getBufferedRanges("audio"),video:e.getBufferedRanges("video")}},t.getBufferDuration=function(){return this.state.bufferedPosition-this.getPosition()},t.getState=function(){return this.state.state},t.getVideoWidth=function(){return this.mediaSinkManager.videoElement().videoWidth},t.getVideoHeight=function(){return this.mediaSinkManager.videoElement().videoHeight},t.getVideoFrameRate=function(){return this.state.statistics.framerate},t.getVideoBitRate=function(){return this.state.statistics.bitrate},t.getAverageBitrate=function(){return this.state.averageBitrate},t.getBandwidthEstimate=function(){return this.state.bandwidthEstimate},t.getPath=function(){return this.state.path},t.getProtocol=function(){return this.state.protocol},t.getVersion=function(){return"1.27.0"},t.isLiveLowLatency=function(){return this.state.liveLowLatencyEnabled&&this.state.liveLowLatency},t.isLooping=function(){return this.state.looping},t.setLogLevel=function(e){!function(e){var t={debug:!1,log:!1,info:!1,warn:!1,error:!1},n=function(e,n){for(var i,r=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return et(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?et(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(e);!(i=r()).done;){var o=i.value;t[o]=n}};switch(e.level){case"debug":n(["debug","log","info","warn","error"],!0);break;case"log":n(["log","info","warn","error"],!0);break;case"info":n(["info","warn","error"],!0);break;case"warn":n(["warn","error"],!0);break;case"error":n(["error"],!0)}!function(e){tt.enabled=e.enabled,tt.levels=N()({},e.levels),nt.emit("logConfigUpdated",e)}({enabled:e.enabled,levels:t})}({enabled:!0,level:e}),this.postMessage("setLogLevel",[e])},t.setLooping=function(e){this.state.looping=e,this.postMessage("setLooping",[e])},t.isMuted=function(){return this.mediaSinkManager.getCurrentSink().isMuted()},t.setMuted=function(e){this.mediaSinkManager.getCurrentSink().setMuted(e)},t.setVolume=function(e){this.state.volume=e,this.postMessage("setVolume",[this.state.volume])},t.getVolume=function(){return this.state.volume},t.getQuality=function(){return this.state.quality},t.setQuality=function(e,t){void 0===t&&(t=!1),this.mediaSinkManager.videoElement().controls||(this.postMessage("setQuality",[e,t]),this.state.autoQualityMode=!1)},t.getQualities=function(){return this.state.qualities},t.setAuthToken=function(e){this.postMessage("setAuthToken",[e])},t.isAutoQualityMode=function(){return this.state.autoQualityMode},t.setAutoQualityMode=function(e){this.state.autoQualityMode=e,this.postMessage("setAutoQualityMode",[e])},t.setAutoInitialBitrate=function(e){this.postMessage("setAutoInitialBitrate",[e])},t.setAutoMaxQuality=function(e){this.postMessage("setAutoMaxQuality",[e])},t.setAutoMaxBitrate=function(e){this.postMessage("setAutoMaxBitrate",[e])},t.setAutoMaxVideoSize=function(e,t){this.postMessage("setAutoMaxVideoSize",[e,t])},t.setAutoViewportSize=function(e,t){this.postMessage("setAutoViewportSize",[e,t])},t.getPlaybackRate=function(){return this.mediaSinkManager.getCurrentSink().getPlaybackRate()},t.setPlaybackRate=function(e){return this.mediaSinkManager.getCurrentSink().setPlaybackRate(e)},t.setClientId=function(e){this.postMessage("setClientId",[e])},t.setDeviceId=function(e){this.postMessage("setDeviceId",[e])},t.setLiveSpeedUpRate=function(e){this.postMessage("setLiveSpeedUpRate",[e])},t.setPlayerType=function(e){this.postMessage("setPlayerType",[e])},t.setLiveMaxLatency=function(e){this.postMessage("setLiveMaxLatency",[e])},t.setLiveLowLatencyEnabled=function(e){this.state.liveLowLatencyEnabled=e,this.postMessage("setLiveLowLatencyEnabled",[e])},t.setRebufferToLive=function(e){var t,n;null!=(t=ct())&&null!=(n=t.getDriftDetectionConfig())&&n.enabled||this.postMessage("setRebufferToLive",[e])},t.setVisible=function(e){this.postMessage("setVisible",[e])},t.setInitialBufferDuration=function(e){this.postMessage("setInitialBufferDuration",[e])},t.addEventListener=function(e,t){this.emitter.on(e,t)},t.removeEventListener=function(e,t){this.emitter.removeListener(e,t)},t.getDroppedFrames=function(){return this.state.statistics.droppedFrames},t.getDecodedFrames=function(){return this.state.statistics.decodedFrames},t.getDisplayWidth=function(){return this.mediaSinkManager.getCurrentSink().getDisplayWidth()},t.getDisplayHeight=function(){return this.mediaSinkManager.getCurrentSink().getDisplayHeight()},t.getSessionId=function(){return this.state.sessionId},t.getSessionData=function(){return this.state.sessionData},t.getLiveLatency=function(){return this.state.liveLatency},t.isProtected=function(){return this.mediaSinkManager.isProtected()},t.startRemotePlayback=function(){this.postMessage("startRemotePlayback")},t.endRemotePlayback=function(){this.postMessage("endRemotePlayback")},t.setPlatformName=function(e){this.postMessage("setPlatformName",[e])},t.setRequestCredentials=function(e){this.postMessage("setRequestCredentials",[e])},t.setSinkType=function(e){this.postMessage("setSinkType",[e])},t.onSinkTimeUpdate=function(){var e=this.mediaSinkManager.getCurrentSink();null===this.seekTime&&(this.postMessage("onClientSinkUpdate",[{currentTime:e.getCurrentTime(),decodedFrames:e.decodedFrames(),droppedFrames:e.droppedFrames(),framerate:e.framerate(),bufferDuration:e.bufferDuration(),displayHeight:e.getDisplayHeight(),displayWidth:e.getDisplayWidth()}]),this.emitter.emit(V.TIME_UPDATE,e.getCurrentTime()))},t.onSinkBufferUpdate=function(){this.emitter.emit(V.BUFFER_UPDATE)},t.onSinkDurationChanged=function(e){this.postMessage("onClientSinkDurationChanged",[e])},t.onSinkEnded=function(){this.postMessage("onClientSinkEnded")},t.onSinkIdle=function(){this.postMessage("onClientSinkIdle")},t.onSinkPlaying=function(e){this.postMessage("onClientSinkPlaying"),e&&this.play()},t.onSinkStop=function(e){var t,n,i=c(document).hidden;if(document[i])this.postMessage("pause");else if(e){if(!this.isMuted()&&(null==(t=null==(n=this.autoPlayOptions)?void 0:n.attemptMutedRetry)||t))return this.setMuted(!0),this.mediaSinkManager.getCurrentSink().play(),void this.emitter.emit(V.AUDIO_BLOCKED);this.pause(),this.emitter.emit(V.PLAYBACK_BLOCKED)}else this.pause()},t.onSinkReset=function(){this.postMessage("onClientSinkReset")},t.onSinkError=function(e){var t=e.value,n=e.code,i=e.message;this.postMessage("onClientSinkError",[t,n,i])},t.onSinkRecoverableError=function(e){var t=e.value,n=e.code,i=e.message;this.postMessage("onClientSinkRecoverableError",[t,n,i])},t.onSinkVideoDisplaySizeChanged=function(e,t){this.setAutoViewportSize(e,t)},t.onSinkVolumeChanged=function(e,t){this.mediaSinkManager.videoElement().controls&&t&&this.setVolume(e),this.emitter.emit(V.VOLUME_CHANGED,this.state.volume)},t.onSinkMutedChanged=function(e){this.postMessage("setMuted",[e]),this.emitter.emit(V.MUTED_CHANGED)},t.onSinkPlaybackRateChanged=function(e){this.postMessage("setPlaybackRate",[e])},t.onPassthroughSinkMetadata=function(e,t,n,i,r){this.emitter.emit(V.TEXT_METADATA_CUE,{description:i,endTime:t,startTime:e,text:n,owner:r,type:"TextMetadataCue"})},t.onPassthroughSinkPropertyChanged=function(e,t){this.postMessage("onClientSinkPassthroughPropertyChanged",[e,t])},t.onSinkControlsChanged=function(e){this.postMessage("setControls",[e])},t.onSinkGapJump=function(e){this.postMessage("onClientSinkGapJump",[e])},t.onRemoteDevice=function(e){this.emitter.emit(e?ke.AVAILABLE:ke.UNAVAILABLE)},t.onRemoteReconnect=function(){this.startRemotePlayback()},t.onSessionError=function(){this.postMessage("onClientSinkError",[1,0,"Chromecast session error"])},t.onLoadMediaError=function(){this.postMessage("onClientSinkError",[1,0,"Chromecast load media failed"])},t.onUserCancel=function(){this.endRemotePlayback(),this.emitter.emit(ke.SESSION_ENDED)},t.onSegmentDiscontinuity=function(){this.mediaSinkManager.onSegmentDiscontinuity()},t.onSessionStop=function(){this.endRemotePlayback(),this.emitter.emit(ke.SESSION_ENDED)},t.onSessionStarted=function(e){this.emitter.emit(ke.SESSION_STARTED,e)},t.attemptPlay=function(){var e=c(document).hidden;!document[e]&&this.isLoaded&&this.postMessage("play")},t.postMessage=function(e,t,n){void 0===n&&(n=[]),this.worker.postMessage({id:this.id,funcName:e,args:t},n)},t.resetState=function(){Object.assign(this.state,{state:Se.IDLE,quality:{name:"",group:"",codecs:"",bitrate:0,width:0,height:0,framerate:0},qualities:[],duration:0,startOffset:0,sessionData:{},volume:1,statistics:{bitrate:0,framerate:0,droppedFrames:0,decodeFrames:0,renderedFrames:0},trackBufferedRanges:{audio:[],video:[]}}),this.emitter.emit(V.DURATION_CHANGED,0),this.seekTime=null,this.isLoaded=!1},t.attachHandlers=function(){var e=this;this.worker.addEventListener("message",this.onmessage);var t=c(document).visibilityChange;document.addEventListener(t,this.onvisibilitychange),window.addEventListener("online",this.onOnline),window.addEventListener("offline",this.onOffline);var n=this.emitter;n.on(V.VOLUME_CHANGED,(function(){return e.onVolumeChanged()})),n.on(V.MUTED_CHANGED,(function(){return e.onMutedChanged()})),n.on(V.SEEK_COMPLETED,(function(){return e.onSeekCompleted()})),n.on(V.ERROR,(function(){return e.onError()})),n.on(V.SESSION_DATA,(function(t){return e.onSessionData(t)})),n.on(V.SEGMENT_DISCONTINUITY,(function(){return e.onSegmentDiscontinuity()})),n.on(Tt.STATE_CHANGED,(function(t){return e.onStateChanged(t)})),n.on(Tt.MEDIA_SINK_RPC,(function(t){return e.mediaSinkManager.applyRPC(t)})),n.on(Tt.CONFIGURE,(function(t){e.mediaSinkManager.configure(t),e.setSinkType(t.mode)})),n.on(Tt.RESET,(function(){return e.mediaSinkManager.reset()})),n.on(ye.ID3,(function(t){return e.onID3(t)})),n.on(Tt.GET_EXPERIMENTS,(function(t){e.experiments=t})),n.on(Tt.PROPERTY_CHANGED,(function(t){var n=t.key,i=t.value;e.state[n]=function(e,t){return"syncTime"===e&&(t*=1e3),t}(n,i)})),n.on(Tt.SYNC_TIME_CHANGED,(function(t){e.emitter.emit(V.SYNC_TIME_UPDATE,1e3*t)})),n.on(Tt.BUFFERED_RANGES,(function(t){e.state.trackBufferedRanges=t})),n.on(Tt.LOG_MESSAGE,(function(e){var t=e.level,n=e.message;return console[t](n)}))},t.onVolumeChanged=function(){var e=c(document).hidden;this.pauseHiddenSilentTab&&document[e]&&0===this.getVolume()&&this.postMessage("pause")},t.onMutedChanged=function(){var e=c(document).hidden;this.pauseHiddenSilentTab&&document[e]&&this.isMuted()&&this.postMessage("pause")},t.onSeekCompleted=function(){this.seekTime=null},t.onError=function(){this.paused=!0},t.onStateChanged=function(e){var t=this;switch(e){case Se.READY:var n=this.isQualitySupported;if(this.adjustments.abrTranscodesOnly&&this.state.qualities.length>1){var i=this.state.qualities.slice().sort((function(e,t){return t.bitrate-e.bitrate}));"chunked"!==i[0].group?n=function(e){return"chunked"!==e.group&&t.isQualitySupported(e)}:this.setAutoMaxQuality(i[1])}var r=function(e,t){var n=[],i=[];return e.forEach((function(e){t(e)?n.push(e):i.push(e)})),{supported:n,unsupported:i}}(this.state.qualities,n);this.state.qualities=r.supported,r.unsupported.forEach((function(e){return t.postMessage("removeQuality",[e])})),this.isLoaded=!0,this.autoPlayOptions&&this.play(),this.paused||this.attemptPlay();break;case Se.ENDED:this.paused=!0}this.emitter.emit(V.STATE_CHANGED,e),this.emitter.emit(e)},t.onID3=function(e){var t=this;e.forEach((function(e){if("TXXX"===e.id&&"segmentmetadata"===e.desc&&e.info.length){var n=s(e.info[0]);if(Object.prototype.hasOwnProperty.call(n,"stream_offset")){var i=Number(n.stream_offset);isNaN(i)||(t.state.startOffset=i-t.getPosition())}}}))},t.onVisibilityChange=function(){var e=c(document).hidden;this.paused||document[e]||this.attemptPlay(),this.pauseHiddenSilentTab&&!this.paused&&document[e]&&(this.isMuted()||0===this.getVolume())&&this.postMessage("pause"),I().firefox||this.postMessage("setVisible",[!document[e]])},t.onSessionData=function(e){Object.assign(this.state,e)},t.onWorkerMessage=function(e){var t=e.data;if(t&&t.id===this.id){var n=this.workerMessageProcessors.reduce((function(e,t){return t(e)}),t),i=n.type,r=n.arg;void 0!==t.arg?this.emitter.emit(i,r):this.emitter.emit(i)}},t.processVideoElementAttributes=function(e){if(e.hasAttribute("autoplay")&&(e.removeAttribute("autoplay"),this.setAutoplay(!0)),e.hasAttribute("playbackRate")){var t,n=parseFloat(null!=(t=e.getAttribute("playbackRate"))?t:"1.0");if(!isNaN(n)){var i=d(n,.25,2);this.setPlaybackRate(i)}e.removeAttribute("playbackRate")}if(e.hasAttribute("src")){var r=e.src;l(e),this.load(r)}if(e.hasAttribute("loop")&&(e.removeAttribute("loop"),this.setLooping(!0)),e.hasAttribute("muted")&&(e.removeAttribute("muted"),this.setMuted(!0)),e.hasAttribute("volume")){var o,a=parseFloat(null!=(o=e.getAttribute("volume"))?o:"1.0");isNaN(a)||this.setVolume(d(a,0,1)),e.removeAttribute("volume")}},t.checkDebugCaptureEnabled=function(){},e}();_t.instanceId=0;var It=function(){function e(e){var t=this;this.workerPort=void 0,this.emitter=void 0,this.messageQueue=void 0,this.workerPort={postMessage:this.postMessageFromWorker.bind(this),onmessage:function(){}},this.emitter=new Xe.EventEmitter,this.messageQueue=new a,this.loadScript(e,(function(e){return t.applyWorkerEnv(e)}))}var t=e.prototype;return t.postMessage=function(e){this.messageQueue?this.messageQueue.push(e):this.postMessageToWorker(e)},t.addEventListener=function(e,t){this.emitter.on(e,t)},t.removeEventListener=function(e,t){this.emitter.off(e,t)},t.onmessage=function(){},t.onmessageerror=function(){},t.onerror=function(){},t.terminate=function(){},t.dispatchEvent=function(){return!0},t.loadScript=function(e,t){var n=this,i=new XMLHttpRequest;i.open("GET",e),i.addEventListener("load",(function(){i.status>=200&&i.status<400?t(i.response):n.emitter.emit("error",new Error(i.statusText))})),i.addEventListener("error",(function(e){n.emitter.emit("error",e)})),i.send()},t.applyWorkerEnv=function(e){if(this.messageQueue){try{Function("self","messageHandler",e)(window,this.workerPort)}catch(e){return void this.emitter.emit("error",e)}for(;!this.messageQueue.empty();)this.postMessageToWorker(this.messageQueue.pop());this.messageQueue=null}},t.postMessageFromWorker=function(e){var t=this;setTimeout((function(){t.emitter.emit("message",{data:e})}),0)},t.postMessageToWorker=function(e){var t=this;setTimeout((function(){t.workerPort.onmessage({data:e})}),0)},e}();function Ot(e,t,n){var i,r,o,a;return void 0===n&&(n=!1),I().msIE?i=new It(e):(r=e,o=window.location,(a=document.createElement("a")).href=r,i=a.hostname===o.hostname&&a.port===o.port&&a.protocol===o.protocol?new Worker(e):new Worker(URL.createObjectURL(new Blob(["importScripts('"+e+"')"])))),i.postMessage({wasmBinaryUrl:t,showWorkerLogs:n}),i}var Nt="undefined"!=typeof window&&"object"==typeof window.WebAssembly&&"function"==typeof window.WebAssembly.instantiate,Vt=Nt;function xt(e){var t=e.asmWorker,n=e.wasmWorker,i=e.wasmBinary;if(!Vt&&!t)throw new Error("WebAssembly is not supported by the browser. This is required for playback.");var r=Ot(Vt?n:t,i,e.showWorkerLog);return new Ht(e,r)}function Ut(){return"1.27.0"}var Bt,Ht=function(){function e(e,t){this.core=void 0,this.startCapture=void 0,this.stopCapture=void 0,this.requestCaptureAnalytics=void 0,this.core=new _t(e,t)}var t=e.prototype;return t.addEventListener=function(e,t){var n;null==(n=this.checkCore())||n.addEventListener(e,t)},t.attachHTMLVideoElement=function(e){var t;null==(t=this.checkCore())||t.attachHTMLVideoElement(e)},t.delete=function(){var e;null==(e=this.checkCore())||e.delete(),this.core=null},t.endRemotePlayback=function(){var e;null==(e=this.checkCore())||e.endRemotePlayback()},t.isAutoplay=function(){var e;return null==(e=this.checkCore())?void 0:e.isAutoplay()},t.isAutoQualityMode=function(){var e;return null==(e=this.checkCore())?void 0:e.isAutoQualityMode()},t.getAverageBitrate=function(){var e;return null==(e=this.checkCore())?void 0:e.getAverageBitrate()},t.getBandwidthEstimate=function(){var e;return null==(e=this.checkCore())?void 0:e.getBandwidthEstimate()},t.getBufferDuration=function(){var e;return null==(e=this.checkCore())?void 0:e.getBufferDuration()},t.getBuffered=function(){var e;return null==(e=this.checkCore())?void 0:e.getBuffered()},t.getBufferedRanges=function(){var e;return null==(e=this.checkCore())?void 0:e.getBufferedRanges()},t.getSinkBufferedRanges=function(){var e;return null==(e=this.checkCore())?void 0:e.getSinkBufferedRanges()},t.getDecodedFrames=function(){var e;return null==(e=this.checkCore())?void 0:e.getDecodedFrames()},t.getDisplayHeight=function(){var e;return null==(e=this.checkCore())?void 0:e.getDisplayHeight()},t.getDisplayWidth=function(){var e;return null==(e=this.checkCore())?void 0:e.getDisplayWidth()},t.getDroppedFrames=function(){var e;return null==(e=this.checkCore())?void 0:e.getDroppedFrames()},t.getDuration=function(){var e;return null==(e=this.checkCore())?void 0:e.getDuration()},t.getExperiments=function(){var e;return null==(e=this.checkCore())?void 0:e.getExperiments()},t.getHTMLVideoElement=function(){var e;return null==(e=this.checkCore())?void 0:e.getHTMLVideoElement()},t.getLiveLatency=function(){var e;return null==(e=this.checkCore())?void 0:e.getLiveLatency()},t.getPath=function(){var e;return null==(e=this.checkCore())?void 0:e.getPath()},t.getProtocol=function(){var e;return null==(e=this.checkCore())?void 0:e.getProtocol()},t.getPlaybackRate=function(){var e;return null==(e=this.checkCore())?void 0:e.getPlaybackRate()},t.getPosition=function(){var e;return null==(e=this.checkCore())?void 0:e.getPosition()},t.getSyncTime=function(){var e;return null==(e=this.checkCore())?void 0:e.getSyncTime()},t.getQualities=function(){var e;return null==(e=this.checkCore())?void 0:e.getQualities()},t.getQuality=function(){var e;return null==(e=this.checkCore())?void 0:e.getQuality()},t.getSessionData=function(){var e;return null==(e=this.checkCore())?void 0:e.getSessionData()},t.getSessionId=function(){var e;return null==(e=this.checkCore())?void 0:e.getSessionId()},t.getStartOffset=function(){var e;return null==(e=this.checkCore())?void 0:e.getStartOffset()},t.getState=function(){var e;return null==(e=this.checkCore())?void 0:e.getState()},t.getVersion=function(){var e;return null==(e=this.checkCore())?void 0:e.getVersion()},t.getVideoBitRate=function(){var e;return null==(e=this.checkCore())?void 0:e.getVideoBitRate()},t.getVideoFrameRate=function(){var e;return null==(e=this.checkCore())?void 0:e.getVideoFrameRate()},t.getVideoHeight=function(){var e;return null==(e=this.checkCore())?void 0:e.getVideoHeight()},t.getVideoWidth=function(){var e;return null==(e=this.checkCore())?void 0:e.getVideoWidth()},t.getVolume=function(){var e;return null==(e=this.checkCore())?void 0:e.getVolume()},t.isLiveLowLatency=function(){var e;return null==(e=this.checkCore())?void 0:e.isLiveLowLatency()},t.isLooping=function(){var e;return null==(e=this.checkCore())?void 0:e.isLooping()},t.isMuted=function(){var e;return null==(e=this.checkCore())?void 0:e.isMuted()},t.isPaused=function(){var e;return null==(e=this.checkCore())?void 0:e.isPaused()},t.isProtected=function(){var e;return null==(e=this.checkCore())?void 0:e.isProtected()},t.isSeeking=function(){var e;return null==(e=this.checkCore())?void 0:e.isSeeking()},t.load=function(e,t){var n;return void 0===t&&(t=""),null==(n=this.checkCore())?void 0:n.load(e,t)},t.pause=function(){var e;null==(e=this.checkCore())||e.pause()},t.play=function(){var e;null==(e=this.checkCore())||e.play()},t.removeEventListener=function(e,t){var n;null==(n=this.checkCore())||n.removeEventListener(e,t)},t.seekTo=function(e){var t;null==(t=this.checkCore())||t.seekTo(e)},t.setAuthToken=function(e){var t;null==(t=this.checkCore())||t.setAuthToken(e)},t.setAutoInitialBitrate=function(e){var t;null==(t=this.checkCore())||t.setAutoInitialBitrate(e)},t.setAutoMaxQuality=function(e){var t;null==(t=this.checkCore())||t.setAutoMaxQuality(e)},t.setAutoMaxBitrate=function(e){var t;null==(t=this.checkCore())||t.setAutoMaxBitrate(e)},t.setAutoMaxVideoSize=function(e,t){var n;null==(n=this.checkCore())||n.setAutoMaxVideoSize(e,t)},t.setAutoplay=function(e){var t;null==(t=this.checkCore())||t.setAutoplay(e)},t.setAutoPlayOptions=function(e){var t;null==(t=this.checkCore())||t.setAutoPlayOptions(e)},t.setAutoQualityMode=function(e){var t;null==(t=this.checkCore())||t.setAutoQualityMode(e)},t.setAutoViewportSize=function(e,t){var n;null==(n=this.checkCore())||n.setAutoViewportSize(e,t)},t.setClientId=function(e){var t;null==(t=this.checkCore())||t.setClientId(e)},t.setDeviceId=function(e){var t;null==(t=this.checkCore())||t.setDeviceId(e)},t.setExperiment=function(e,t){var n;null==(n=this.checkCore())||n.setExperiment(e,t)},t.setExperimentData=function(e){var t;null==(t=this.checkCore())||t.setExperimentData(e)},t.setInitialBufferDuration=function(e){var t;null==(t=this.checkCore())||t.setInitialBufferDuration(e)},t.setLiveLowLatencyEnabled=function(e){var t;null==(t=this.checkCore())||t.setLiveLowLatencyEnabled(e)},t.setLiveMaxLatency=function(e){var t;null==(t=this.checkCore())||t.setLiveMaxLatency(e)},t.setLiveSpeedUpRate=function(e){var t;null==(t=this.checkCore())||t.setLiveSpeedUpRate(e)},t.setLogLevel=function(e){var t;null==(t=this.checkCore())||t.setLogLevel(e)},t.setLooping=function(e){var t;null==(t=this.checkCore())||t.setLooping(e)},t.setMuted=function(e){var t;null==(t=this.checkCore())||t.setMuted(e)},t.setPlaybackRate=function(e){var t;null==(t=this.checkCore())||t.setPlaybackRate(e)},t.setPlayerType=function(e){var t;null==(t=this.checkCore())||t.setPlayerType(e)},t.setQuality=function(e,t){var n;void 0===t&&(t=!1),null==(n=this.checkCore())||n.setQuality(e,t)},t.setRebufferToLive=function(e){var t;null==(t=this.checkCore())||t.setRebufferToLive(e)},t.setVisible=function(e){var t;null==(t=this.checkCore())||t.setVisible(e)},t.setVolume=function(e){var t;null==(t=this.checkCore())||t.setVolume(e)},t.startRemotePlayback=function(){var e;null==(e=this.checkCore())||e.startRemotePlayback()},t.setPlatformName=function(e){var t;null==(t=this.checkCore())||t.setPlatformName(e)},t.setRequestCredentials=function(e){var t;null==(t=this.checkCore())||t.setRequestCredentials(e)},t.checkCore=function(){return this.core||console.warn("Method called on deleted player instance."),this.core},e}(),Ft=function(e){return e.UNKNOWN="Unspecified",e.FILE="File",e.SEGMENT="Segment",e.SOURCE="Source",e.DECODER="Decode",e.RENDERER="Render",e.MASTER_PLAYLIST="MasterPlaylist",e.MEDIA_PLAYLIST="MediaPlaylist",e.DRM="DRM",e}({}),Gt=function(e){return e.GENERIC="Error",e.NOT_SUPPORTED="ErrorNotSupported",e.NO_SOURCE="ErrorNoSource",e.INVALID_DATA="ErrorInvalidData",e.INVALID_STATE="ErrorInvalidState",e.INVALID_PARAMETER="ErrorInvalidParameter",e.TIMEOUT="ErrorTimeout",e.NETWORK="ErrorNetwork",e.NETWORK_IO="ErrorNetworkIO",e.AUTHORIZATION="ErrorAuthorization",e.NOT_AVAILABLE="ErrorNotAvailable",e}({}),Wt=function(e){return e[e.GEOBLOCKED=1]="GEOBLOCKED",e[e.UNSUPPORTED_DEVICE=2]="UNSUPPORTED_DEVICE",e[e.ANONYMIZER_BLOCKED=3]="ANONYMIZER_BLOCKED",e[e.CELLULAR_NETWORK_PROHIBITED=4]="CELLULAR_NETWORK_PROHIBITED",e[e.UNAUTHORIZATION_ENTITLEMENTS=5]="UNAUTHORIZATION_ENTITLEMENTS",e[e.VOD_RESTRICTED=6]="VOD_RESTRICTED",e}({}),jt=function(e){return e.CAPTURE_ENABLED="CaptureEnabled",e.CAPTURE_BUNDLE="CaptureBundle",e.CAPTURE_ANALYTICS="CaptureAnalytics",e.FMP4_SEGMENT="FMP4Segment",e}({}),Kt=function(e){return e.DEBUG="debug",e.INFO="info",e.WARN="warn",e.ERROR="error",e}({}),qt=function(e){return e.DURATION_CHANGE="durationchange",e.ENDED="ended",e.ERROR="error",e.LOADED_METADATA="loadedmetadata",e.LOADSTART="loadstart",e.PAUSE="pause",e.PLAY="play",e.PLAYING="playing",e.RATE_CHANGE="ratechange",e.SEEKED="seeked",e.SEEKING="seeking",e.TIME_UPDATE="timeupdate",e.VOLUME_CHANGE="volumechange",e.WAITING="waiting",e}({}),Qt=function(e){return e[e.HAVE_NOTHING=0]="HAVE_NOTHING",e[e.HAVE_METADATA=1]="HAVE_METADATA",e[e.HAVE_CURRENT_DATA=2]="HAVE_CURRENT_DATA",e[e.HAVE_FUTURE_DATA=3]="HAVE_FUTURE_DATA",e[e.HAVE_ENOUGH_DATA=4]="HAVE_ENOUGH_DATA",e}(Qt||{}),Yt=((Bt={})[Se.IDLE]=1,Bt[Se.READY]=1,Bt[Se.BUFFERING]=2,Bt[Se.PLAYING]=2,Bt[Se.ENDED]=1,Bt),Xt="AmazonIVS";function zt(e,t){if(void 0===e||"function"!=typeof e.getTech)throw{message:"videojs not available, AmazonIVS tech not registered",code:1};if(!Vt)throw{message:"WebAssembly support is required for AmazonIVS tech",code:2};if(!e.getTech(Xt)){var n,i={featuresProgressEvents:!0,featuresTimeupdateEvents:!0,featuresPlaybackRate:!0,featuresFullscreenResize:!0,featuresVolumeControl:!0,featuresMuteControl:!0,featuresNativeTextTracks:!1,privateContructor:function(n,i,r){this._readyState=Qt.HAVE_NOTHING,this._defaultPlaybackRate=1,this._seeking=!1,t.playerFramework={name:"videojs",version:e.VERSION},this._mediaPlayer=xt(t),this._mediaPlayer.setAutoplay(!0===n.autoplay),this._attachVideojsListeners(),this._mediaPlayer.addEventListener(V.METADATA,this._onCaptionEvent.bind(this));var o=this._createEl(n);n.el=o,r(this,n,i),window.vttjs&&window.vttjs.restore(),this.triggerReady(),setTimeout(function(){var e=this.options(),t=e.loop,n=e.muted;t&&this._mediaPlayer.setLooping(!0),n&&this._mediaPlayer.setMuted(!0)}.bind(this),0)},dispose:function(){this._mediaPlayer.delete()},setPreload:function(){},autoplay:function(e){if("boolean"!=typeof e)return this._mediaPlayer.autoplay;this.setAutoplay(e)},setAutoplay:function(e){this._mediaPlayer.setAutoplay(e)},preload:function(){},load:function(){},readyState:function(){return this._readyState},seeking:function(){return this._seeking},networkState:function(){if(!this._mediaPlayer)return 0;if(!this._mediaPlayer.getHTMLVideoElement().src)return 3;var e=this._mediaPlayer.getState();return Yt[e]},ended:function(){return this._mediaPlayer.getState()===Se.ENDED},seekable:function(){return e.createTimeRange(0,this._mediaPlayer.getDuration())},play:function(){this._mediaPlayer.play(),this.trigger(qt.PLAY)},pause:function(){this._mediaPlayer.pause()},setCurrentTime:function(e){this._mediaPlayer.getHTMLVideoElement().src&&(this._mediaPlayer.seekTo(e),this._seeking=!0,this.trigger(qt.SEEKING))},controls:function(){return!1},setControls:function(){return!1},muted:function(){return this._mediaPlayer.isMuted()},setMuted:function(e){this._mediaPlayer.setMuted(e)},volume:function(){return this._mediaPlayer.getVolume()},setVolume:function(e){this._mediaPlayer.setVolume(e)},defaultPlaybackRate:function(e){if(!e)return this._defaultPlaybackRate;this._defaultPlaybackRate=e},playbackRate:function(){return this._mediaPlayer.getPlaybackRate()},setPlaybackRate:function(e){this._mediaPlayer.setPlaybackRate(e)},paused:function(){return this._mediaPlayer.isPaused()},duration:function(){return this._mediaPlayer.getDuration()},currentTime:function(){return this._mediaPlayer.getPosition()},_createEl:function(e){var t=this._mediaPlayer.getHTMLVideoElement();t.setAttribute("class","vjs-tech"),void 0!==e.disablePictureInPicture&&(t.disablePictureInPicture=e.disablePictureInPicture),["preload","poster"].forEach(function(n){e[n]&&t.setAttribute(n,e[n])}.bind(this)),e.playsinline&&(t.setAttribute("webkit-playsinline",""),t.setAttribute("playsinline",""));var n=document.createElement("div");return n.appendChild(t),n},src:function(e){this.trigger(qt.LOADSTART),this._seeking=!1,this._captionTrack&&(this.textTracks().removeTrack(this._captionTrack),this._captionTrack=null),e&&this._mediaPlayer.load(e)},addEventListener:function(e,t){this._mediaPlayer.addEventListener(e,t)},removeEventListener:function(e,t){this._mediaPlayer.removeEventListener(e,t)},getMediaPlayerAPI:function(){return this._mediaPlayer},supportsFullScreen:function(){return!0},enterFullScreen:function(){var e=this._mediaPlayer.getHTMLVideoElement();(e.requestFullscreen||e.webkitRequestFullscreen||e.mozRequestFullScreen||e.msRequestFullscreen||e.webkitEnterFullscreen||function(){console.error("Fullscreen API is not available")}).call(e)},exitFullScreen:function(){(document.exitFullScreen||document.webkitExitFullscreen||document.mozCancelFullScreen||document.msExitFullscreen||function(){console.error("Exitscreen API is not available")}).call(document)},requestPictureInPicture:function(){return this._mediaPlayer.getHTMLVideoElement().requestPictureInPicture()},setDisablePictureInPicture:function(e){this._mediaPlayer.getHTMLVideoElement().disablePictureInPicture=e},disablePictureInPicture:function(){return this._mediaPlayer.getHTMLVideoElement().disablePictureInPicture},_onCaptionEvent:function(e){if("text/json"===e.type){var t=JSON.parse(e.data);if(t.caption){var n=t.caption;this._captionTrack||(this._captionTrack=this.addTextTrack("captions",n.format),this._currentCue=null),this._currentCue&&this._captionTrack.removeCue(this._currentCue);var i=this._mediaPlayer.getHTMLVideoElement(),r=window.VTTCue||window.vttjs.VTTCue;r?(this._currentCue=new r(i.currentTime,i.currentTime+2,n.text),this._captionTrack.addCue(this._currentCue)):console.warn("No VTTCue implementation available, caption may not be available")}}},_attachVideojsListeners:function(){this._mediaPlayer.addEventListener(Se.READY,function(){this._readyState=Qt.HAVE_METADATA,this.trigger(qt.LOADED_METADATA)}.bind(this)),this._mediaPlayer.addEventListener(Se.IDLE,function(){this._readyState=Qt.HAVE_NOTHING,this.trigger(qt.PAUSE)}.bind(this)),this._mediaPlayer.addEventListener(Se.PLAYING,function(){this._readyState<=Qt.HAVE_CURRENT_DATA&&(this._readyState=Qt.HAVE_FUTURE_DATA),this.trigger(qt.PLAY),this.trigger(qt.PLAYING)}.bind(this)),this._mediaPlayer.addEventListener(Se.ENDED,function(){this._readyState=Qt.HAVE_NOTHING,this.trigger(qt.ENDED)}.bind(this)),this._mediaPlayer.addEventListener(Se.BUFFERING,function(){this._readyState=Qt.HAVE_CURRENT_DATA}.bind(this)),this._mediaPlayer.addEventListener(V.REBUFFERING,function(){this._readyState=Qt.HAVE_CURRENT_DATA,this.trigger(qt.WAITING)}.bind(this)),this._mediaPlayer.addEventListener(V.TIME_UPDATE,function(){this.trigger(qt.TIME_UPDATE)}.bind(this)),this._mediaPlayer.addEventListener(V.VOLUME_CHANGED,function(){this.trigger(qt.VOLUME_CHANGE)}.bind(this)),this._mediaPlayer.addEventListener(V.MUTED_CHANGED,function(){this.trigger(qt.VOLUME_CHANGE)}.bind(this)),this._mediaPlayer.addEventListener(V.ERROR,function(){this.trigger(qt.ERROR)}.bind(this)),this._mediaPlayer.addEventListener(V.DURATION_CHANGED,function(){this.trigger(qt.DURATION_CHANGE)}.bind(this)),this._mediaPlayer.addEventListener(V.SEEK_COMPLETED,function(){this._seeking=!1,this.trigger(qt.SEEKED)}.bind(this)),this._mediaPlayer.addEventListener(V.PLAYBACK_RATE_CHANGED,function(){this.trigger(qt.RATE_CHANGE)}.bind(this))}},r=e.getTech("Tech");"function"==typeof e.extend?(i.constructor=function(e,t){this.privateContructor(e,t,(function(e,t,n){r.call(e,t,n)}))},n=e.extend(r,i,Xt)):((n=function(e,t){this.privateContructor(e,t,(function(e,t,n){var i=r.prototype,o=i.featuresProgressEvents,a=i.featuresTimeupdateEvents,s=i.featuresPlaybackRate,u=i.featuresFullscreenResize,c=i.featuresVolumeControl,d=i.featuresMuteControl,l=i.featuresNativeTextTracks;i.featuresProgressEvents=!0,i.featuresTimeupdateEvents=!0,i.featuresPlaybackRate=!0,i.featuresFullscreenResize=!0,i.featuresVolumeControl=!0,i.featuresMuteControl=!0,i.featuresNativeTextTracks=!1,Object.assign(e,new r(t,n)),e.on(qt.PLAYING,(function(){e.hasStarted_=!0})),e.on(qt.LOADSTART,(function(){e.hasStarted_=!1})),i.featuresProgressEvents=o,i.featuresTimeupdateEvents=a,i.featuresPlaybackRate=s,i.featuresFullscreenResize=u,i.featuresVolumeControl=c,i.featuresMuteControl=d,i.featuresNativeTextTracks=l}))}).prototype=Object.create(r.prototype),Object.assign(n.prototype,i)),n.supportsFullScreen=function(){return!0},n.isSupported=function(){return-1===(navigator.appVersion||"").toLowerCase().indexOf("rv:11")},n.canPlayType=function(e){return"string"==typeof e&&e.length>0&&(e.indexOf("application/x-mpegURL")>-1?"undefined"!=typeof MediaSource&&MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'):""!==document.createElement("video").canPlayType(e))},n.canPlaySource=function(){return!0},e.registerTech("AmazonIVS",n);var o=e.registerPlugin||e.plugin;o("getIVSEvents",(function(){return{PlayerEventType:V,MetadataEventType:ye,PlayerState:Se,ErrorType:Gt}})),o("getIVSPlayer",(function(){return this.tech(!0).getMediaPlayerAPI()}))}}var Jt="enableIVSQualityPlugin";function Zt(e){if(void 0===e||"function"!=typeof e.getTech)throw{message:"videojs not available, Amazon IVS Quality Plugin not registered",code:1};if(!e.getPlugin(Jt)){var t,n=e.getComponent("MenuButton"),i=e.getComponent("MenuItem"),r={privateConstructor:function(e,t,n){n(this,e,t),this.controlText("Quality")},createItems:function(){var e=this.player(),t=e.getIVSPlayer(),n=[],r=new i(e,{selectable:!0,label:"Auto",qualityGroup:"auto"});r.selected(t.isAutoQualityMode()),r.on(["click","tap"],(function(){t.setAutoQualityMode(!0)})),r.on(["click","tap"],this._clickHandler.bind(this,r)),n.push(r);var o=t.getQuality(),a=t.getQualities();return a&&a.length>0&&a.forEach(function(r){var a=new i(e,{selectable:!0,label:r.name,qualityGroup:r.group}),s=function(e){t.setQuality(e)}.bind(null,r);a.on(["click","tap"],s),a.on(["click","tap"],this._clickHandler.bind(this,a)),t.isAutoQualityMode()||a.selected(o.group===r.group),n.push(a)}.bind(this)),t.addEventListener(V.QUALITY_CHANGED,(function(n){var i;if(!t.isAutoQualityMode()){var r=null==(i=e.controlBar)?void 0:i.getChild("QualityMenuButton");null==r||r.items.forEach((function(e){var t=e.options().qualityGroup;n&&t&&e.selected(n.group===t)}))}})),this.qualityItems=n,n},buildCSSClass:function(){return"vjs-icon-hd vjs-icon-placeholder "+n.prototype.buildCSSClass.call(this)},_clickHandler:function(e){this.items.forEach((function(t){t!==e&&t.selected(!1)}))}};"function"==typeof e.extend?(r.constructor=function(e,t){this.privateConstructor(e,t,(function(e,t,i){n.call(e,t,i)}))},t=e.extend(n,r)):((t=function(e,t){this.privateConstructor(e,t,(function(e,t,i){var r="quality-control";i.name=r;var o=new n(t,i);o.getChild(r).addClass("vjs-icon-hd vjs-icon-placeholder"),Object.assign(e,o),e.items=e.createItems(),e.items.forEach((function(t){e.menu.addItem(t)}))}))}).prototype=Object.create(n.prototype),Object.assign(t.prototype,r)),e.registerComponent("QualityMenuButton",t),(e.registerPlugin||e.plugin)(Jt,(function(){var e=this;e.getIVSPlayer().addEventListener(Se.READY,(function(){var t,n,i=null==(t=e.controlBar)?void 0:t.getChild("QualityMenuButton");i&&(i.dispose(),e.controlBar.removeChild(i)),null==(n=e.controlBar)||n.addChild("QualityMenuButton")}))}))}}module.exports=t}();